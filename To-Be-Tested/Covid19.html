<head>
  <title>COVID-19 Stats</title>
  <meta description="A theme to help visualize active ratios and counts for COVID-19 cases globally.  This theme is updated in realtime with data from worldometers.info, with each dot representing 60,000 cases. Light blue dots represent active (unresolved) cases, dark blue are recovered cases, red are fatalities, and purple are critical condition.  A red pulse means that case counts overall have increased."/>
  <meta publisher="SignalRGB" />
  
  <script src="http://code.jquery.com/jquery-latest.js"></script>

  <script>
    /*! WhirlwindFX meter snippet v1.0 | (c) 2020 Whirlwind Virtual Realities, Inc.*/
    function Meter(e,i){this.size=e,this.value=0,this.diff=0,this.increased=!1,this.decreased=!1;var s=[];this.setValue=function(e){s.push(e),s.length>this.size&&s.shift();for(var t=0;t<s.length-1;t++)if(s[t]!==s[t+1])return;this.value!==s[0]&&(this.diff=Math.abs(this.value-s[0]),this.increased=this.value<s[0],this.decreased=this.value>s[0],this.value=s[0],i())}}
  </script>
<script async src='/cdn-cgi/bm/cv/669835187/api.js'></script></head>

<body style="margin: 0; padding: 0;">
  <canvas id="exCanvas" width="320" height="200"></canvas>
<script type="text/javascript">(function(){window['__CF$cv$params']={r:'6d87e9e35f701fad',m:'6RnVpsumsgyknrP0y2XlZhzYjDUywDllAdgXRsEXcR8-1644019804-0-AROZcBaaLj9iZ3frlKD4i5RGNziEk7ERBmzH7cJyHo46jyKBAmuwzhT7pV6bwjXQx+k1fQVIolJhfHrLAYIRWJRoKjQnBZshAKz7fvZ7uJ/c+DkE/U12qeZveRHa1DniJMgFoJ9f7oZ3vB8uAlBqBZfy0kFK4mURd7+NKdznpf0J8305mxpxkycx0AT0pHUWog==',s:[0x4bebb9b994,0x37880d0237],}})();</script></body>

<script>
  var c = document.getElementById("exCanvas");
  var ctx = c.getContext("2d");  
  var width = 320;
  var height = 200;
  var cases = new Meter(1, onCasesChanged);
  var deaths = new Meter(1, onDeathsChanged);
  var recovered = new Meter(1, onRecoveredChanged);
  var critical = new Meter(1, onCriticalChanged);
  var speed = 3;
  var caseorbs = [];
  var caseIncPhase = 0;
  var casesPerDot = 60000;
  var loaded = false;
  
  function addAlpha(color, opacity) 
  {    
    const _opacity = Math.round(Math.min(Math.max(opacity || 1, 0), 1) * 255);
    return color + _opacity.toString(16).toUpperCase();
  }


  function random(min, max) 
  {
    var num = (Math.random() * (max - min)) + min;
    // if min = 10 max = 15 random var = 0.1544465; it will return approzimately 10 because of math.floor
    return num;
  }


  function checkCases()
  {    
    $.getJSON("https://corona.lmao.ninja/v2/all",
      { format: "json" },
      function(retval) {
        //console.log("Got data:"+JSON.stringify(retval));
        loaded = true;
        if (retval.hasOwnProperty('cases')){ cases.setValue(retval['cases']); }
        if (retval.hasOwnProperty('deaths')){ deaths.setValue(retval['deaths']); }
        if (retval.hasOwnProperty('recovered')){ recovered.setValue(retval['recovered']); }
        if (retval.hasOwnProperty('critical')){ critical.setValue(retval['critical']); }
      })
      .fail(function(jqXHR, textStatus, errorThrown)  { 
        
        console.log('getJSON XHR: ' + JSON.stringify(jqXHR));
        console.log('getJSON text: ' + textStatus);
        console.log('getJSON error: ' + errorThrown);
      });             

      setTimeout(function() {
          if (!loaded)
          {
            console.log("Offline, loading manually.");
            cases.setValue(87527995);
            deaths.setValue(1888219);
            recovered.setValue(63058907);
            critical.setValue(108748);
          }
      }, 2000);
  }


  function onCasesChanged() 
  {
    var orbCount = cases.value / casesPerDot;

    console.log("Cases: " + cases.value + ", diff: "+cases.diff+" , count: " +orbCount);
    
    if (orbCount > 10000) { 
      orbCount = 10000; 
      console.log("We've reached max orbz! "+orbCount);
    }

    if (cases.value > 0 && cases.value === cases.diff)
    {
      while(caseorbs.length < orbCount)
      {
        caseorbs.push(new Ball(200));
      }      
    }

    var bFirstRun = cases.value === cases.diff;
    if (!bFirstRun && cases.diff > 0) {
      caseIncPhase = 100;
    }
  }


  function onDeathsChanged() 
  {
    console.log("Deaths: " + deaths.value + ", diff: "+deaths.diff);
    var orbCount = deaths.value / casesPerDot;
    
    var end = caseorbs.length-1;
    for(var i=end; i > end - orbCount; i--){
      caseorbs[i].setHue(0, 100, 50);
      caseorbs[i].setSpeed(.4);
    }
  }


  function onRecoveredChanged() 
  {
    console.log("Recovered: " + recovered.value + ", diff: "+recovered.diff);

    var orbCount = recovered.value / casesPerDot;
    for(var i=0; i < orbCount; i++){
      caseorbs[i].setHue(220, 100, 30);
      caseorbs[i].setSpeed(.4);
    }
  }

  function onCriticalChanged() 
  {
    console.log("Critical: " + critical.value + ", diff: "+critical.diff);

    var fatalCount = deaths.value / casesPerDot;
    var end = Math.floor(caseorbs.length-fatalCount-1);    
    var orbCount = Math.floor(critical.value / casesPerDot);
    
    for(var i=end; i > end - orbCount; i--){      
      caseorbs[i].setHue(280, 100, 50);
      caseorbs[i].setSpeed(.4);
    }
  }


  function update() 
  {
    ctx.fillStyle = 'hsla('+ 0 + ', 100%, 0%, 10%)';
    ctx.fillRect(0, 0, width, height);

    for (i = 0; i < caseorbs.length; i++) {
      caseorbs[i].draw();
      caseorbs[i].update();
    }

    if (caseIncPhase > 0) {
      var norm = caseIncPhase / 100;
      if (norm > .1)
      {        
        ctx.fillStyle = addAlpha("#ff0000",norm);
        ctx.fillRect(0, 0, width, height);
      }
      caseIncPhase -= .5;
    }

    window.requestAnimationFrame(update);
  }
  

  function Ball(hue) {
    this.x = random(5, width - 5);
    this.y = random(5, height - 5);
    
    this.angle = random(0, 360);

    this.velX = 1;
    this.velY = 1;
    this.setSpeed(.5);

    this.size = 4;
    this.hue = hue;
    this.brightness = 35;
    this.saturation = 100;
  }


  Ball.prototype.setHue = function(value, sat, brightness) {
    this.hue = value;
    this.saturation = sat;
    this.brightness = brightness;
  }


  Ball.prototype.setSpeed = function(value) {

    if (this.speed !== value) {
      this.speed = value;
      this.velX = this.speed * Math.sin(this.angle);
      this.velY = this.speed * Math.cos(this.angle);
    }
  }


  Ball.prototype.draw = function () {     
    ctx.fillStyle = 'hsl('+ this.hue + ', '+this.saturation+'%, ' + this.brightness + '%)';
    ctx.fillRect(this.x, this.y, this.size, this.size);    
  }


  Ball.prototype.update = function () {
    if ((this.x + this.size) >= width) {
      this.velX = -(this.velX);
    }

    if ((this.x - this.size) <= 0) {
      this.velX = -(this.velX);
    }

    if ((this.y + this.size + 1) >= height) {
      this.velY = -(this.velY);
    }

    if ((this.y - this.size + 1) <= 0) {
      this.velY = -(this.velY);
    }

    this.x += this.velX;
    this.y += this.velY;
  }


  checkCases();
  setInterval(checkCases, 600000);
  window.requestAnimationFrame(update);

</script>

<!--script type="text/javascript" src="https://corona.lmao.ninja/v2/all?callback=my_callback"></script-->