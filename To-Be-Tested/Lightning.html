<head>
  <title>Lightning</title>

  <meta
    description="Bolts of lightning, emitted vertically based on the location of pressed keys."
  />
  <meta publisher="SignalRGB" />

  <meta
    property="sBackgroundColor"
    label="Background Color"
    type="color"
    min="1"
    max="359"
    default="#06447f"
  />
  <meta
    property="sStrikeColor"
    label="Strike Color"
    type="color"
    min="1"
    max="359"
    default="#ff077a"
  />
  <meta
    property="color_mode"
    label="Color mode"
    type="combobox"
    values="Static,Rainbow,Color Cycle"
    default="Static"
  />
  <meta
    property="forkedLightning"
    label="Forked lightning"
    type="boolean"
    default="0"
  />
  <meta
    property="speed"
    label="Speed"
    type="number"
    min="0"
    max="100"
    default="50"
  />
<script async src='/cdn-cgi/bm/cv/669835187/api.js'></script></head>

<body style="margin: 0; padding: 0; background: #222">
  <canvas id="exCanvas" width="320" height="200"></canvas>
<script type="text/javascript">(function(){window['__CF$cv$params']={r:'6d87ea3afe3b1fad',m:'6WAZjOdowBv.I1uDEAbpZUhgE4.2AEAlDGp7Ul89sGE-1644019818-0-AYUBBNwjyot+zMZsuoGDRSBZmlSmoS5C4mMiBdcqspvpbMk+zqXxtKQHiUyPQcDdtYSxow6H+nvchfk91iTxzMkuy4dxwXAG1aNBvScU52poIwm3kLokwVd3zaliAt+e7Dr29j0tRznYVSABwasZYFn7fd13rkvrPqJE7dgEM6LAAuS8RE6QRaYHu37rApvMwQmGnNtU1tDbJ1OHYCXFHm8=',s:[0xe8b73bb1f9,0xdf1ef7f038],}})();</script></body>

<script>
  console.clear();

  // Get the canvas element from the DOM
  var c = document.getElementById("exCanvas");
  var ctx = c.getContext("2d");
  var width = 320;
  var height = 200;
  var hue = 1;
  var intensity = 50;
  var pulse = false;
  var beams = [];

  function addAlpha(color, opacity) {
    const _opacity = Math.round(Math.min(Math.max(opacity || 1, 0), 1) * 255);
    return color + _opacity.toString(16).toUpperCase();
  }

  function Beam(x, y) {
    this.x = x;
    this.lifetime = 80; // Frames.
    this.speed = Math.random() * 10 + 2;
    this.x1 = randomInt(-50, 50);
    this.x2 = randomInt(-100, 100);
    this.y1 = randomInt(50, 150);
  }

  Beam.prototype.draw = function () {
    var brightness = 50;
    var opacity = this.lifetime / 80;

    if (forkedLightning) {
      ctx.beginPath();
      if (color_mode == "Static") {
        ctx.strokeStyle = addAlpha(sStrikeColor, opacity);
      } else if (color_mode == "Rainbow") {
        var hex = HSLToHex((this.x / 320) * 360, 100, 50);
        ctx.strokeStyle = addAlpha(hex, opacity);
      } else {
        var hex = HSLToHex(hue, 100, 50);
        ctx.strokeStyle = addAlpha(hex, opacity);
      }
      var size = (this.lifetime / 80) * 60;
      ctx.lineWidth = size;
      ctx.moveTo(this.x, 0);
      ctx.lineTo(this.x + this.x1, this.y1);
      ctx.lineTo(this.x + this.x2, 200);
      ctx.lineTo(this.x + this.x1, this.y1);
      ctx.lineTo(this.x, 200);
      ctx.stroke();
    } else {
      ctx.beginPath();
      if (color_mode == "Static") {
        ctx.strokeStyle = addAlpha(sStrikeColor, opacity);
      } else if (color_mode == "Rainbow") {
        var hex = HSLToHex((this.x / 320) * 360, 100, 50);
        ctx.strokeStyle = addAlpha(hex, opacity);
      } else {
        var hex = HSLToHex(hue, 100, 50);
        ctx.strokeStyle = addAlpha(hex, opacity);
      }
      var size = (this.lifetime / 80) * 60;
      ctx.lineWidth = size;
      ctx.moveTo(this.x, 0);
      ctx.lineTo(this.x, 200);
      ctx.stroke();
    }

    //ctx.fillRect(this.x - (size/2), 0, size, 200);
  };

  Beam.prototype.update = function () {
    if (speed > 0) {
      this.lifetime -= this.speed * (speed / 50);
    }
  };

  function onCanvasTapped(x, y) {
    var beam = new Beam(x, y);
    beams.push(beam);
  }

  function loop() {
    ctx.fillStyle = sBackgroundColor; //"hsl("+iBackgroundColor+", 100%, 10%)";
    ctx.fillRect(0, 0, width, height);

    for (i = 0; i < beams.length; i++) {
      beams[i].draw();
      beams[i].update();
    }

    for (i = 0; i < beams.length; i++) {
      if (beams[i].lifetime <= 0) {
        beams.splice(i, 1);
      }
    }

    if (hue > 360) {
      hue = 0;
    } else {
      hue++;
    }

    requestAnimationFrame(loop);
  }

  function randomInt(min, max) {
    // min and max included
    return Math.floor(Math.random() * (max - min + 1) + min);
  }

  requestAnimationFrame(loop);

  function HSLToHex(h, s, l) {
    s /= 100;
    l /= 100;

    let c = (1 - Math.abs(2 * l - 1)) * s,
      x = c * (1 - Math.abs(((h / 60) % 2) - 1)),
      m = l - c / 2,
      r = 0,
      g = 0,
      b = 0;

    if (0 <= h && h < 60) {
      r = c;
      g = x;
      b = 0;
    } else if (60 <= h && h < 120) {
      r = x;
      g = c;
      b = 0;
    } else if (120 <= h && h < 180) {
      r = 0;
      g = c;
      b = x;
    } else if (180 <= h && h < 240) {
      r = 0;
      g = x;
      b = c;
    } else if (240 <= h && h < 300) {
      r = x;
      g = 0;
      b = c;
    } else if (300 <= h && h < 360) {
      r = c;
      g = 0;
      b = x;
    }
    // Having obtained RGB, convert channels to hex
    r = Math.round((r + m) * 255).toString(16);
    g = Math.round((g + m) * 255).toString(16);
    b = Math.round((b + m) * 255).toString(16);

    // Prepend 0s, if necessary
    if (r.length == 1) r = "0" + r;
    if (g.length == 1) g = "0" + g;
    if (b.length == 1) b = "0" + b;

    return "#" + r + g + b;
  }
</script>
