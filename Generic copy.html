<head>
    <title>Generic</title>
    <meta description="Snake-like climbing gradient effect"/>
    <meta publisher="WhirlwindFX" />
    <meta property="radius" label="Size" type="number" min="5" max="100" default="20">
    <meta property="amount" label="Amount" type="number" min="1" max="50" default="2">
    <meta property="floor" label="Floor Bounce" type="number" min="0" max="50" default="10">
    <meta property="impact" label="impact color" type="hue" default="1" min="0" max="360">
    <meta property="fade" label="color fade" type="number" min="1" max="20" default="5">
    <meta property="trail" label="trail fade" type="number" min="1" max="20" default="4">
    <meta property="background" label="background color" type="color" default="#000000" min="0" max="360"/>
</head>
    
<body style="margin: 0; padding: 0;">
  	<canvas id="exCanvas" width="320" height="200"></canvas>
</body>
    
<script>
    // Get the canvas element from the DOM
    var c = document.getElementById("exCanvas");
    var ctx = c.getContext("2d");  
    var width = 320;
    var height = 200;
    var hue = 0;
    let cx = 160;
    let vx = 0;
    let cy = 100;
    let vy = 0;
    let ay = 1;
    let effects = [];

    function update() {
			
      ctx.fillStyle = background;
      ctx.globalAlpha = 1 / trail;
      ctx.fillRect(0, 0, 320,200);
      ctx.globalAlpha = 1;

      if (effects.length < amount){
        effects.push(new Ball());
      } else if (effects.length > amount){
        effects.pop();
      }

      effects.forEach(ele => {
        ele.draw();
      })


      window.requestAnimationFrame(update);
    }

    function Ball(){
      this.radius = radius;
      this.bx = Math.random() * width;
      this.vx = 10 * Math.sin(Date.now());
      this.by = Math.random() * height;
      this.vy = 0;
      this.ay = 2;
      this.id = Math.random();
      this.lightness = 0;

      this.draw = function(){
        this.radius = radius;
        this.vy += ay;
        this.vx += Math.sin(Date.now());
        
        if (this.by + this.radius + this.vy > 200){
          this.vy = floor * -1;
          this.lightness = 60;
        } else if (this.by - this.radius + this.vy < 0){
          this.vy = 1;
          this.lightness = 60;
        }
        if (this.bx + this.radius + this.vx > 320){
          this.vx *= -1
          this.lightness = 60;
        } else if (this.bx - this.radius + this.vx < 0){
          this.vx *= -1;
          this.lightness = 60;
        }
        
        for (let i = 0; i < effects.length; i++){
          let ele = effects[i];
          if (this.id == ele.id){
            continue;
          }
          if (Math.abs(this.bx - ele.bx) < this.radius && Math.abs(this.by - ele.by) < this.radius){
            effects.splice(i, 1);
          }
          if (Math.abs(this.bx + this.vx - ele.bx) < (this.radius * 2) && Math.abs(this.by + this.vy - ele.by) < (this.radius * 2)){
            this.lightness = 60;
            this.vx *= -.9;
            this.vy *= -.9;
          }
        }
        this.bx += this.vx;
        this.by += this.vy;

        
        while (this.bx - this.radius < 0){
          this.bx++
        }
        while (this.bx + this.radius > 320){
          this.bx--
        }
        while (this.by - this.radius < 0){
          this.by++
        }
        while (this.by + this.radius > 200){
          this.by--
        }

        ctx.beginPath();
  		  ctx.arc(this.bx, this.by, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = `hsl(${impact}, 50%, ${this.lightness}%)`
        ctx.fill();
        this.lightness -= fade;
      }
    }

    window.requestAnimationFrame(update);

</script>