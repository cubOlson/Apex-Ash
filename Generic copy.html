<head>
    <title>Basic Effects</title>
    <meta description="Basic Effects" />
    <meta publisher="SignalRgb" />

    <meta property="Bar" label="BarEffect" type="boolean" default="0" />
    <meta property="Ripple" label="RippleEffect" type="boolean" default="0" />
    <meta
    property="theY"
    label="Ambiance brightness"
    type="number"
    min="-200"
    max="200"
    default="100"
  />

</head>

<body style="margin: 0; padding: 0;">
    <canvas id="exCanvas" width="320" height="200"></canvas>
</body>

<script>
    var c = document.getElementById("exCanvas");
    var ctx = c.getContext("2d");

    var width = 320;
    var height = 200;
    var hue = 0;
    var effects = [];
    var animPlaying = false;

    function update() {

        ctx.fillStyle = "black";
        ctx.fillRect(0,0, 320, 200);

        if (effects.length < 1){
            effects.push(new dragonEffect("grey", "blue"));
        }

        for (let i = 0; i < effects.length; i++) {
            effects[i].draw();
            if (effects[i].lifetime <= 0) {
                effects.splice(i, 1);
            }
        }

        window.requestAnimationFrame(update);
    }

    function dragonEffect(color1, color2){
      this.lifetime = 30;
      this.color1 = color1;
      this.color2 = color2;
      this.y = 250;
      this.draw = function(){
        ctx.lineWidth = 20;
        ctx.strokeStyle = this.color1;
        ctx.beginPath();
        ctx.moveTo(160, this.y);
        ctx.lineTo(160, this.y + 200);
        ctx.stroke();

        ctx.fillStyle = this.color1;
        ctx.beginPath();
        ctx.moveTo(160, this.y + 50);
        ctx.lineTo(200, this.y + 50);
        ctx.lineTo(180, this.y + 25);
        ctx.lineTo(320, this.y + 25);
        ctx.lineTo(240, this.y + 100);
        ctx.lineTo(160, this.y + 125);
        ctx.lineTo(160, this.y + 50);
        ctx.fill();

        ctx.beginPath();
        ctx.moveTo(160, this.y + 50);
        ctx.lineTo(120, this.y + 50);
        ctx.lineTo(140, this.y + 25);
        ctx.lineTo(0, this.y + 25);
        ctx.lineTo(80, this.y + 100);
        ctx.lineTo(160, this.y + 125);
        ctx.lineTo(160, this.y + 50);
        ctx.fill();

        this.y-=10;
        if (this.y <= -150){
          this.lifetime = 0;
          effects.push(new ParticleExplosion(160, 200, this.color2, 10, 1000, 10, 10, 1.5, false))
          setTimeout(()=>{effects.push(new ParticleExplosion(160, 150, this.color2, 10, 1000, 10, 10, 1.5, false))}, 100)
          setTimeout(()=>{effects.push(new ParticleExplosion(160, 100, this.color2, 10, 1000, 10, 10, 1.5, false))}, 200)
          setTimeout(()=>{effects.push(new ParticleExplosion(160, 50, this.color2, 10, 1000, 10, 10, 1.5, false))}, 300)
          setTimeout(()=>{effects.push(new ParticleExplosion(160, 0, this.color2, 10, 1000, 10, 10, 1.5, false))}, 400)
        }
      }
    }

    function DrawCircle(x,y,radius,color){
        ctx.beginPath();
        ctx.fillStyle = color;
        ctx.arc(x,y,radius, 0, 2* Math.PI)
        ctx.fill();
    };

    function DrawTriangle(cord1X,cord1Y,cord2X,cord2Y,cord3X,cord3Y, color) {
      ctx.beginPath();
      ctx.fillStyle = color;
      ctx.moveTo(cord1X, cord1Y);
      ctx.lineTo(cord2X,cord2Y);
      ctx.lineTo(cord3X,cord3Y);
      ctx.lineTo(cord1X,cord1Y);
      ctx.fill();
    };

    function ParticleExplosion(x, y, color, speed, duration, particleAmount, particleSize, fadeSpeed, notrandomY) {
    this.start = GetTime();
    this.col = color;
    this.speed = speed;
    this.duration = duration;
    this.lifetime = 2000;
    this.amount = particleAmount;
    this.size = particleSize
    this.x = x;
    this.y = y;
    this.fadeSpeed = fadeSpeed;
    this.particles = [];
   
    while (this.particles.length < this.amount) {
       if (notrandomY) {
        this.yspeed = -this.speed/1.5;
      } else {
        this.yspeed = ((Math.random() - 0.5) * this.speed);
      }
      this.particles.push(new ExplosionParticle(this.x, this.y, this.size, this.col, this.fadeSpeed,
        {
          x: ((Math.random() - 0.5) * this.speed),
          y: this.yspeed
        }))
      this.draw = function () {
        this.lifetime = this.duration - (GetTime() - this.start)
        this.particles.forEach((Particle, index) => {
          Particle.draw()
        })
      }
    }
  };

  class ExplosionParticle {
      constructor(x, y, radius, color, fadeSpeed, velocity) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.radius = radius;
        this.velocity = velocity;
        this.alpha = 1 * fadeSpeed;
      }
      draw() {
        ctx.globalAlpha = this.alpha;
        ctx.beginPath()
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false)
        ctx.fillStyle = this.color
        ctx.fill()
        this.x += this.velocity.x
        this.y += this.velocity.y
        this.alpha -= 0.01
      }
    }

    function RippleEffect(x, y, speed, duration, rippleWidth, color, inOrOut, fillOrStroke, amountOfRipples, background) {
        this.col = color;
        this.speed = speed;
        this.dur = duration;
        this.width = rippleWidth;
        this.start = GetTime();
        this.lifetime;
        this.x = x;
        this.y = y;
        this.fill = fillOrStroke;
        this.radius = 0;
        this.amount = amountOfRipples;
        this.background = background;
        if (inOrOut == "in") {
          this.radius = 200 + (this.width * (this.amount * 2));
          this.speed = -this.speed
        }
        this.draw = function () {
          if(this.background){
            DrawBackground("black");
          }
          
          
          ctx.lineWidth = this.width;
          ctx.beginPath();
          for (let i = 0; i < this.amount; i++) {
            if (this.radius - i * (this.width * 2) > 0) {
              ctx.arc(this.x, this.y, this.radius - i * (this.width * 2), 0, 2 * Math.PI);
            }
          }
          if (this.fill == "fill") {
            ctx.fillStyle = this.col;
            ctx.fill();
          } else {
            ctx.strokeStyle = this.col;
            ctx.stroke();
          }
          this.radius += this.speed;
          this.lifetime = this.dur - (GetTime() - this.start);
          if (this.lifetime <= 0){
            utilityPlayed = false;
          }
        }
      }

    function GetTime() {
      return new Date().getTime()
    }

    window.requestAnimationFrame(update);
</script>