<head>
    <title>Basic Effects</title>
    <meta description="Basic Effects" />
    <meta publisher="SignalRgb" />

    <meta property="Bar" label="BarEffect" type="boolean" default="0" />
    <meta property="Ripple" label="RippleEffect" type="boolean" default="0" />

</head>

<body style="margin: 0; padding: 0;">
    <canvas id="exCanvas" width="320" height="200"></canvas>
</body>

<script>
    var c = document.getElementById("exCanvas");
    var ctx = c.getContext("2d");

    var width = 320;
    var height = 200;
    var hue = 0;
    var effects = [];
    var animPlaying = false;

    function GetTime() {
        return new Date().getTime();
    }

    function BarEffect(direction, color, speed, duration, barWidth, amountOfBars) {
        this.dir = direction;
        this.col = color;
        this.dur = duration;
        this.start = GetTime();
        this.lifetime;
        this.x = 0;
        this.y = 0;
        this.bW = barWidth;
        this.speed = speed;
        this.amount = amountOfBars;
        switch (this.dir) {
            case "up":
                this.y = c.height;
                this.speed = -this.speed;
                break;
            case "right":
                this.x -= this.bW;
                break;
            case "down":
                this.y -= this.bW;
                break;
            case "left":
                this.x = c.width + this.bW + (this.amount * this.bW);
                this.speed = -this.speed;
                break;
        }
        this.draw = function () {
            ctx.fillStyle = this.col;
            for (let i = 0; i < this.amount; i++) {
                if (this.dir == "up" || this.dir == "down") {
                    ctx.fillRect(this.x, this.y - ((this.bW * 2) * i), c.width, this.bW);
                    this.y += this.speed / this.amount;
                } else {
                    ctx.fillRect(this.x - ((this.bW * 2) * i), this.y, this.bW, c.height);
                    this.x += this.speed / this.amount;
                }
            }
            this.lifetime = this.dur - (GetTime() - this.start);
        }
    }
    function DrawBackground(color) {
        ctx.fillStyle = color;
        ctx.fillRect(0, 0, c.width, c.height)
    }

    function RippleEffect(x, y, speed, duration, rippleWidth, color, inOrOut, fillOrStroke, amountOfRipples) {
        this.col = color;
        this.speed = speed;
        this.dur = duration;
        this.width = rippleWidth;
        this.start = GetTime();
        this.lifetime;
        this.x = x;
        this.y = y;
        this.fill = fillOrStroke;
        this.radius = 0;
        this.amount = amountOfRipples;
        if (inOrOut == "in") {
            this.radius = 200 + (this.width*(this.amount*2));
            this.speed = -this.speed
        }
        this.draw = function () {
            ctx.strokeStyle = this.col;
            ctx.fillStyle = this.col;
            ctx.lineWidth = this.width;
            ctx.beginPath();
            for (let i = 0; i < this.amount; i++) {
                if (this.radius- i* (this.width * 2) > 0) {
                    ctx.arc(this.x, this.y, this.radius-i*(this.width*2), 0, 2 * Math.PI);
                }
            }
            if (this.fill == "fill") {
                ctx.fill();
            } else {
                ctx.stroke();
            }
            this.radius += this.speed;
            this.lifetime = this.dur - (GetTime() - this.start);
        }
    }

    function copyScreen() {

        var shine = engine.vision.ShineMeter
        let lightness = new Int8Array(engine.zone.lightness);
        let sat = new Int8Array(engine.zone.saturation);
        let hue = new Int16Array(engine.zone.hue);
        for (var iZone = 0; iZone < 560; iZone++) {
            var iRow = Math.floor(iZone / 28);
            var iCol = iZone % 28;
            var iWidth = 320 / 28;
            var iHeight = 200 / 20;
            var iZx = iCol * iWidth;
            var iZy = iRow * iHeight;
            ctx.fillStyle =
                "hsla(" +
                hue[iZone] +
                "," +
                sat[iZone] +
                "%," +
                lightness[iZone] +
                "%, " +
                "1" +
                ")";
            ctx.fillRect(iZx, iZy, iWidth, iHeight);
        }
    }

    function update() {

        copyScreen();

        if (Bar == true && animPlaying == false) {
            effects.push(new BarEffect("right", "blue", 6, 4000, 250, 5));
            animPlaying = true;
        }

        if (Ripple == true && animPlaying == false) {
            effects.push(new RippleEffect(160, 200, 5, 5000, 50, "blue", "in", "stroke",5))
            animPlaying = true;
        }

        for (let i = 0; i < effects.length; i++) {
            effects[i].draw();
            if (effects[i].lifetime <= 0) {
                effects.splice(i, 1);
            }
        }
        if (effects.length == 0) {
            animPlaying = false;
        }
        window.requestAnimationFrame(update);
    }

    window.requestAnimationFrame(update);
</script>