<head>
  <title>Minecraft Java Edition Production</title>
  <meta description="Game intergration for Minecraft Java edition. 
  You must use auto GUI scaling and select your resolution.
  0 = 1080p, 1 = 1440p, 2 = 2160p" />
  <meta publisher="WhirlwindFX" />
  <meta property="selector" label="Resolution Slider" type="number" min="0" max="2" default="0" />
  <meta property="enableHealth" label="Health effect" type="boolean" default="1" />
  <meta property="effectHex1" label="Decrease Health effect Color" type="color" min="0" max="360" default="#ff0000" />
  <meta property="effectHex2" label="Increase Health effect Color" type="color" min="0" max="360" default="#ff57ae" />
  <meta property="enableHunger" label="Hunger effect" type="boolean" default="1" />
  <meta property="effectHex3" label="Hunger state effect Color" type="color" min="0" max="360" default="#572b00" />
  <meta property="effectHex4" label="Is Fed effect Color" type="color" min="0" max="360" default="#fc8c03" />
  <meta property="enableXP" label="XP effect" type="boolean" default="1" />
  <meta property="enableBoss" label="Boss bar effect" type="boolean" default="1" />
  <meta property="enableFire" label="On Fire effect" type="boolean" default="1" />

  <meta meter="Fire" tags="minecraft" x=".03" y=".95" width=".005" height=".005" h="0-30" s="60-100" l="30-100"
    type="area" />
  <meta meter="osdHD" tags="minecraft" x=".59" y=".40" width=".0052" height=".0046" h="0-360" s="0-10" l="70-100"
    type="area" />
  <meta meter="osdHD2" tags="minecraft" x=".3245" y=".7833" width=".3" height=".0046" h="0-360" s="0-10" l="70-100"
    type="area" />
  <meta meter="osdHD3" tags="minecraft" x=".4406" y=".5537" width=".24" height=".02" h="0-360" s="0-10" l="70-100"
    type="area" />
  <meta meter="osdQHD" tags="minecraft" x=".612" y=".402" width=".0052" height=".0046" h="0-360" s="0-10" l="70-100"
    type="area" />
  <meta meter="osdUHD" tags="minecraft" x=".612" y=".402" width=".0052" height=".0046" h="0-360" s="0-10" l="70-100"
    type="area" />
  <meta meter="guiHD" tags="minecraft" x=".61" y=".39" width=".0052" height=".0046" h="0-360" s="0-10" l="30-50"
    type="area" />
  <meta meter="guiHD2" tags="minecraft" x=".2927" y=".6398" width=".03" height=".02" h="0-360" s="0-10" l="30-50"
    type="area" />
  <meta meter="guiHDBlocker" tags="minecraft" x=".4922" y=".3546" width=".01" height=".07" h="0-360" s="0-10" l="30-50"
    type="area" />
  <meta meter="guiHDBlocker2" tags="minecraft" x=".2927" y=".625" width=".03" height=".01" h="0-360" s="0-10" l="30-50"
    type="area" />
  <meta meter="guiQHD" tags="minecraft" x=".603" y=".319" width=".0052" height=".0046" h="0-360" s="0-10" l="30-50"
    type="area" />
  <meta meter="guiUHD" tags="minecraft" x=".603" y=".319" width=".0052" height=".0046" h="0-360" s="0-1" l="30-50"
    type="area" />

  <meta meter="healthHD" tags="minecraft" x=".3150" y=".87" width=".1575" height=".0030" h="0-20" s="60-100" l="0-100"
    type="area" />
  <meta meter="healthQHD" tags="minecraft" x=".291" y=".8472" width=".1625" height=".0074" h="0-20" s="40-100" l="0-100"
    type="area" />
  <meta meter="healthUHD" tags="minecraft" x=".291" y=".8472" width=".1625" height=".0074" h="0-20" s="60-100" l="0-100"
    type="area" />
  <meta meter="foodHD" tags="photos" x=".5295" y=".865" width=".165" height=".002" h="0-50" s="40-80" l="65-100"
    type="area" />
  <meta meter="foodHDBlocker" tags="minecraft" x=".5295" y=".858" width=".165" height=".002" h="0-50" s="40-80"
    l="65-100" type="area" />
  <meta meter="foodQHD" tags="minecraft" x=".5281" y=".8472" width=".15" height=".004" h="0-50" s="40-80" l="65-100"
    type="area" />
  <meta meter="foodUHD" tags="minecraft" x=".5281" y=".8472" width=".15" height=".004" h="0-50" s="40-80" l="65-100"
    type="area" />
  <meta meter="armorHD" tags="minecraft" x=".3124" y=".83" width=".164" height=".0020" h="0-360" s="0-10" l="70-80"
    type="area" />
  <meta meter="armorQHD" tags="minecraft" x=".29" y=".805" width=".164" height=".004" h="0-360" s="0-10" l="70-80"
    type="area" />
  <meta meter="armorUHD" tags="minecraft" x=".29" y=".81" width=".164" height=".0046" h="0-360" s="0-10" l="70-80"
    type="area" />
  <meta meter="xpHD" tags="minecraft" x=".3188" y=".9009" width=".376" height=".002" h="80-100" s="30-100" l="0-100"
    type="area" />

  <meta meter="xpQHD" tags="minecraft" x=".2898" y=".8861" width=".376" height=".002" h="80-100" s="30-100" l="0-100"
    type="area" />
  <meta meter="xpUHD" tags="minecraft" x=".2898" y=".8861" width=".376" height=".002" h="80-100" s="30-100" l="0-100"
    type="area" />
  <meta meter="bossHD" tags="minecraft" x=".3151" y=".0490" width=".3125" height=".002" h="260-330" s="80-100"
    l="70-100" type="area" />

  <meta meter="bossQHD" tags="minecraft" x=".2894" y=".059" width=".4167" height=".0020" h="250-330" s="80-100"
    l="70-100" type="area" />

  <meta meter="bossUHD" tags="minecraft" x=".3151" y=".0490" width=".3625" h="260-280" s="90-100" l="80-100"
    type="linear" />
</head>

<body style="margin: 0; padding: 0; background: #000">
  <canvas id="exCanvas" width="320" height="200"></canvas>
</body>

<script>
  var canvas, ctx, osdOpen;
  var stateMgr = new StateHandler();
  var healthMeter = new Meter(10, onHealthMeterChanged);
  var xpMeter = new Meter(10, onXpMeterChanged);
  var foodMeter = new Meter(50, onFoodMeterChanged);
  var armorMeter = new Meter(10, onArmorMeterChanged);
  var bossMeter = new Meter(10, onBossMeterChanged);
  var fireMeter = new Meter(3, onFireMeterChanged);
  var foodMeterBlocker = new Meter(10, onFoodMeterChanged);
  var guiMeter = new Meter(7, onguiChanged);
  var guiMeterBlocker = new Meter(4, onguiChanged);
  var OsdMeter = new Meter(7, onguiChanged);



  function onguiChanged() {
    //console.log(`Gui Value ${guiMeter.value} blocker Value ${guiMeterBlocker.value} osd ${OsdMeter.value}`);
    if ((guiMeter.value > 1.7 && guiMeterBlocker.value < .2) || OsdMeter.value > .8) {
      osdOpen = true;
    } else {
      osdOpen = false;
    }
  }

  function onFireMeterChanged() {
    if (enableFire === 1) {
      if (fireMeter.value > 0.5) {
        stateMgr.Push(new fireState());
      }
    }
  }
  function onHealthMeterChanged() {
    //console.log(healthMeter.value);
    if (enableHealth === 1) {
      if (healthMeter.decreased && !osdOpen) {
        stateMgr.Push(new DamageState());
      } else if (healthMeter.increased && !osdOpen) {
        stateMgr.Push(new HealState());
      }
    }
  }

  function onXpMeterChanged() {
    if (enableXP === 1) {
      if (xpMeter.increased && !osdOpen && xpMeter.value > 0.01) {
        stateMgr.Push(new XpUpState());
      }
    }
  }

  function onFoodMeterChanged() {
    //console.log(foodMeter.value);
    if (enableHunger === 1) {
      if (foodMeter.decreased && !osdOpen && foodMeterBlocker.value < .1) {
        stateMgr.Push(new HungerState());
      } else if (foodMeter.increased && !osdOpen) {
        stateMgr.Push(new FedState());
      }
    }
  }

  function onArmorMeterChanged() {
    stateMgr.Push(new ArmorState());
  }

  function onBossMeterChanged() {
    if (enableBoss === 1) {
      if (bossMeter.increased && !osdOpen) {
        //console.log(bossMeter.value);
        stateMgr.Push(new BossState());
      }
    }
  }

  function XpUpState() {
    this.start = new Date().getTime();
    this.lifetime = 45;

    this.Process = function () {
      if (this.lifetime == 0) {
        stateMgr.Pop();
      }
      this.Draw();
    };

    this.Draw = function () {
      this.lifetime -= 1;

      ctx.fillStyle = "#42d113";
      ctx.fillRect(0, 0, 320, 200);

      ctx.fillStyle = "#e1ff00";
      ctx.beginPath();
      ctx.arc(Math.random() * 320, Math.random() * 200, 25, 0, 2 * Math.PI);
      ctx.arc(Math.random() * 320, Math.random() * 200, 25, 0, 2 * Math.PI);
      ctx.arc(Math.random() * 320, Math.random() * 200, 25, 0, 2 * Math.PI);
      ctx.fill();
    };
  }
  function fireState() {
    this.start = new Date().getTime();
    this.lifetime = 20;

    this.Process = function () {
      if (this.lifetime == 0) {
        stateMgr.Pop();
      }
      this.Draw();
    };

    this.Draw = function () {
      this.lifetime -= 1;

      ctx.fillStyle = "#e25822";
      ctx.fillRect(0, 0, 320, 200);
      ctx.fillStyle = "#fac000";
      ctx.fillRect(Math.random() * 320, Math.random() * 200, 50, 50);
      ctx.fillRect(Math.random() * 320, Math.random() * 200, 50, 50);
      ctx.fillRect(Math.random() * 320, Math.random() * 200, 50, 50);
      ctx.fillRect(Math.random() * 320, Math.random() * 200, 50, 50);
    };
  }

  function DamageState() {
    this.start = new Date().getTime();
    this.lifetime = 45;

    this.Process = function () {
      if (this.lifetime == 0) {
        stateMgr.Pop();
      }
      this.Draw();
    };

    this.Draw = function () {
      this.lifetime -= 1;

      if (this.lifetime > 10 && this.lifetime < 15) {
        ctx.fillStyle = "#ffffff";
      } else if (this.lifetime > 40 && this.lifetime < 45) {
        ctx.fillStyle = "#ffffff";
      } else {
        ctx.fillStyle = effectHex1;
      }
      ctx.fillRect(0, 0, 320, 200);
    };
  }

  function HealState() {
    this.start = new Date().getTime();
    this.lifetime = 45;

    this.Process = function () {
      if (this.lifetime == 0) {
        stateMgr.Pop();
      }
      this.Draw();
    };

    this.Draw = function () {
      this.lifetime -= 1;

      ctx.fillStyle = "#ff57ae";
      ctx.fillRect(0, 0, 320, 200);

      ctx.strokeStyle = "white";
      ctx.lineWidth = 10;
      ctx.beginPath();
      ctx.arc(160, 100, 4 * (45 - this.lifetime), 0, 2 * Math.PI);
      ctx.stroke();

      ctx.fillStyle = "white";
      ctx.fillRect(Math.random() * 320, Math.random() * 200, 10, 10);
      ctx.fillRect(Math.random() * 320, Math.random() * 200, 10, 10);
      ctx.fillRect(Math.random() * 320, Math.random() * 200, 10, 10);
    };
  }

  function ArmorState() {
    this.start = new Date().getTime();
    this.lifetime = 45;

    this.Process = function () {
      if (this.lifetime == 0) {
        stateMgr.Pop();
      }
      this.Draw();
    };

    this.Draw = function () {
      this.lifetime -= 1;

      if (this.lifetime < 10) {
        ctx.fillStyle = "rgba(255,255,255," + this.lifetime / 10 + ")";
      } else if (this.lifetime > 35) {
        ctx.fillStyle = "rgba(255,255,255," + (35 - this.lifetime) / 10 + ")";
      } else {
        ctx.fillStyle = "white";
      }
      ctx.fillRect(0, 0, armorMeter.value * 500, 200);
    };
  }

  function IdleState() {
    this.Process = function () {
      let lightness = new Int8Array(engine.zone.lightness);
      let sat = new Int8Array(engine.zone.saturation);
      let hue = new Int16Array(engine.zone.hue);

      for (var iZone = 0; iZone < 560; iZone++) {
        if (healthMeter.value < 0.2 && healthMeter.value > 0 && !osdOpen) {
          var satboost = sat[iZone] + 30;
          ctx.fillStyle =
            "hsl(" + 0 + "," + satboost + "%," + lightness[iZone] + "%)";
        } else if (!osdOpen) {
          ctx.fillStyle =
            "hsl(" +
            hue[iZone] +
            "," +
            sat[iZone] +
            "%," +
            lightness[iZone] +
            "%)";
        } else {
          ctx.fillStyle = "#696969";
        }

        var iRow = Math.floor(iZone / 28);
        var iCol = iZone % 28;
        var iWidth = 320 / 28;
        var iHeight = 200 / 20;
        var iZx = iCol * iWidth;
        var iZy = iRow * iHeight;

        ctx.fillRect(iZx, iZy, iWidth, iHeight);
      }
    };
  }

  function BossState() {
    this.Process = function () {
      let lightness = new Int8Array(engine.zone.lightness);
      let sat = new Int8Array(engine.zone.saturation);
      let hue = new Int16Array(engine.zone.hue);
      //console.log(bossMeter.value);
      for (var iZone = 0; iZone < 560; iZone++) {
        if (iZx > bossMeter.value * 320) {
          ctx.fillStyle =
            "hsl(" +
            hue[iZone] +
            "," +
            sat[iZone] +
            "%," +
            lightness[iZone] +
            "%)";
        } else {
          ctx.fillStyle =
            "hsl(" + 273 + "," + sat[iZone] + "%," + lightness[iZone] + "%)";
        }
        var iRow = Math.floor(iZone / 28);
        var iCol = iZone % 28;
        var iWidth = 320 / 28;
        var iHeight = 200 / 20;
        var iZx = iCol * iWidth;
        var iZy = iRow * iHeight;

        ctx.fillRect(iZx, iZy, iWidth, iHeight);
      }
    };
  }

  function HungerState() {
    this.start = new Date().getTime();
    this.lifetime = 45;

    this.Process = function () {
      if (this.lifetime == 0) {
        stateMgr.Pop();
      }
      this.Draw();
    };

    this.Draw = function () {
      this.lifetime -= 1;

      ctx.fillStyle = effectHex3;
      ctx.fillRect(0, 0, 320, 200);
    };
  }

  function FedState() {
    this.start = new Date().getTime();
    this.lifetime = 45;

    this.Process = function () {
      if (this.lifetime == 0) {
        stateMgr.Pop();
      }
      this.Draw();
    };

    this.Draw = function () {
      this.lifetime -= 1;

      ctx.fillStyle = effectHex4;
      ctx.fillRect(0, 0, 320, 200);

      ctx.fillStyle = "white";
      ctx.fillRect(Math.random() * 320, Math.random() * 200, 10, 10);
      ctx.fillRect(Math.random() * 320, Math.random() * 200, 10, 10);
      ctx.fillRect(Math.random() * 320, Math.random() * 200, 10, 10);
    };
  }

  function StateHandler() {
    var stack = [];
    var state = null;

    var updateState = function () {
      if (stack.length > 0) {
        state = stack[stack.length - 1];
      } else {
        state = null;
      }
    };

    this.Push = function (newState) {
      stack.push(newState);
      updateState();
    };

    this.Pop = function () {
      stack.pop();
      updateState();
    };

    this.Process = function () {
      if (state != null) {
        state.Process();
      }
    };
  }

  function Meter(count, callback) {
    this.size = count;
    this.value = 0;
    this.diff = 0;
    this.increased = false;
    this.decreased = false;
    var values = [];

    this.setValue = function (updatedValue) {
      // Add and shift.
      values.push(updatedValue);
      if (values.length > this.size) {
        values.shift();
      }

      // Exit early if we've got a long-term match.
      for (var i = 0; i < values.length - 1; i++) {
        if (values[i] !== values[i + 1]) return;
      }

      // We got here, so we've got a matching value collection.
      if (this.value !== values[0]) {
        //var fromZero = this.value === 0;
        //var toZero = values[0] === 0;
        this.diff = Math.abs(this.value - values[0]);
        this.increased = this.value < values[0];
        this.decreased = this.value > values[0];
        this.value = values[0];

        callback();
      }
    };
  }

  function update() {


    switch (Math.round(selector)) {
      case (0):

        guiMeter.setValue(engine.vision.guiHD + engine.vision.guiHD2);
        guiMeterBlocker.setValue(engine.vision.guiHDBlocker + engine.vision.guiHDBlocker2);
        OsdMeter.setValue(engine.vision.osdHD + engine.vision.osdHD2 + engine.vision.osdHD3);
        healthMeter.setValue(engine.vision.healthHD);
        xpMeter.setValue(engine.vision.xpHD);
        foodMeter.setValue(engine.vision.foodHD);
        foodMeterBlocker.setValue(engine.vision.foodHDBlocker);
        armorMeter.setValue(engine.vision.armorHD);
        bossMeter.setValue(engine.vision.bossHD);
        fireMeter.setValue(engine.vision.Fire);
        break;

      case (1):

        healthMeter.setValue(engine.vision.healthQHD);
        xpMeter.setValue(engine.vision.xpQHD);
        foodMeter.setValue(engine.vision.foodQHD);
        armorMeter.setValue(engine.vision.armorQHD);
        bossMeter.setValue(engine.vision.bossQHD);
        fireMeter.setValue(engine.vision.Fire);


      case (2):

        healthMeter.setValue(engine.vision.healthUHD);
        xpMeter.setValue(engine.vision.xpUHD);
        foodMeter.setValue(engine.vision.foodUHD);
        armorMeter.setValue(engine.vision.armorUHD);
        bossMeter.setValue(engine.vision.bossUHD);
        fireMeter.setValue(engine.vision.Fire);


    }

    stateMgr.Process();

    window.requestAnimationFrame(update);
  }

  function onEngineReady() {
    // Grab canvas and rendering context.
    canvas = document.getElementById("exCanvas");
    ctx = canvas.getContext("2d");

    stateMgr.Push(new IdleState());
    // Start updates *after* our engine is accessible and ready.
    window.requestAnimationFrame(update);
  }
</script>