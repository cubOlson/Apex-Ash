<head>
  <title>Black Hole</title>
  <meta description="A swirling black hole effect." />
  <meta publisher="SignalRGB" />
  <meta
    property="palette"
    label="Color palette"
    type="combobox"
    values="Rainbow,Space,Custom,Random"
    default="Space"
  />
  <meta
    property="fgHue1"
    label="Hue 1"
    type="hue"
    min="0"
    max="360"
    default="0"
  />
  <meta
    property="fgHue2"
    label="Hue 2"
    type="hue"
    min="0"
    max="360"
    default="130"
  />
  <meta
    property="fgHue3"
    label="Hue 3"
    type="hue"
    min="0"
    max="360"
    default="240"
  />
  <meta
    property="partSize"
    label="Particle Size"
    type="number"
    min="1"
    max="20"
    default="10"
  />
  <meta
    property="speedRaw"
    label="Speed"
    type="number"
    min="0"
    max="100"
    default="50"
  />
  <meta
    property="eventHoriz"
    label="Event Horizon Size"
    type="number"
    min="1"
    max="100"
    default="46"
  />
  <meta
    property="extremeMode"
    label="Extreme mode"
    type="boolean"
    min="0"
    max="1"
    default="0"
  />
</head>

<body style="margin: 0; padding: 0">
  <canvas id="exCanvas" width="320" height="200"></canvas>
</body>

<script>
  var c = document.getElementById("exCanvas");
  var ctx = c.getContext("2d");
  var width = 320;
  var height = 200;

  var effects = [];
  var effects2 = [];
  var rotate = 1;
  var eventHoriz = 46;
  var palette = "Space";
  var bgColor = "#000000";

  var fgHue1 = 69;
  var fgHue2 = 69;
  var fgHue3 = 69;

  var partSize = 10;
  var speedRaw = 50;

  var colorLib = [];
  colorLib["Rainbow"] = [];
  colorLib["Space"] = [];
  colorLib["Aurora"] = [];
  colorLib["Water"] = [];
  colorLib["Fire"] = [];
  colorLib["Custom"] = [];
  colorLib["Random"] = [];

  var spaceLib = [];
  var spaceLibBg = getRandomInt(240, 280);

  var randomBg = getRandomInt(0, 360);
  var rainBg = 0;

  const bgImageData = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAA+CAAAAAD4nOEZAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAo/aVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA3LjEtYzAwMCA3OS5hODczMWI5LCAyMDIxLzA5LzA5LTAwOjM3OjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJHb29nbGUiIHhtcDpDcmVhdGVEYXRlPSIyMDIxLTEyLTE2VDE2OjU3OjE1LTA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMS0xMi0xNlQxNzozNTowOS0wODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMS0xMi0xNlQxNzozNTowOS0wODowMCIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjEzZDEzNjRmLTdhODktYzk0MC04MTdjLWE4NjZhZGJmZWY2MyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1YmQ0MzZhOC1hMTliLTQ3NGQtODhiZC0yZDk2MjczYzI2ZDQiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0iQUIwQkFDRjY4Njk0NDZFOEQ4RThGNzkwQ0I0RUMxMzYiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHRpZmY6SW1hZ2VXaWR0aD0iMTkyMCIgdGlmZjpJbWFnZUxlbmd0aD0iMTIwMCIgdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPSIyIiB0aWZmOlNhbXBsZXNQZXJQaXhlbD0iMyIgdGlmZjpYUmVzb2x1dGlvbj0iMS8xIiB0aWZmOllSZXNvbHV0aW9uPSIxLzEiIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjEiIGV4aWY6RXhpZlZlcnNpb249IjAyMjAiIGV4aWY6Q29sb3JTcGFjZT0iMSIgZXhpZjpQaXhlbFhEaW1lbnNpb249IjE5MjAiIGV4aWY6UGl4ZWxZRGltZW5zaW9uPSIxMjAwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MjIxNjIxZTctZjk1OS0zOTQyLTgzN2YtOTA0ZGI4OTZiNDQ5IiBzdEV2dDp3aGVuPSIyMDIxLTEyLTE2VDE2OjU4OjE0LTA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjMuMCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9qcGVnIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvanBlZyB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEzNTFlOGM2LTlhYTAtZjU0My04OWQ2LTFlYzZmMTkyNTkxNSIgc3RFdnQ6d2hlbj0iMjAyMS0xMi0xNlQxNjo1ODoxNC0wODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIzLjAgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1YmQ0MzZhOC1hMTliLTQ3NGQtODhiZC0yZDk2MjczYzI2ZDQiIHN0RXZ0OndoZW49IjIwMjEtMTItMTZUMTc6MzU6MDktMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMy4wIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MjIxNjIxZTctZjk1OS0zOTQyLTgzN2YtOTA0ZGI4OTZiNDQ5IiBzdFJlZjpkb2N1bWVudElEPSJBQjBCQUNGNjg2OTQ0NkU4RDhFOEY3OTBDQjRFQzEzNiIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJBQjBCQUNGNjg2OTQ0NkU4RDhFOEY3OTBDQjRFQzEzNiIvPiA8dGlmZjpCaXRzUGVyU2FtcGxlPiA8cmRmOlNlcT4gPHJkZjpsaT44PC9yZGY6bGk+IDxyZGY6bGk+ODwvcmRmOmxpPiA8cmRmOmxpPjg8L3JkZjpsaT4gPC9yZGY6U2VxPiA8L3RpZmY6Qml0c1BlclNhbXBsZT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7ebShMAAAA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";
  const bgImage = new Image();
  bgImage.src = bgImageData;

  for (let i = 0; i < 200; i++) {
    spaceLib[i] = [getRandomInt(240, 280), getRandomInt(50, 100)];
  }

  var customHues = [fgHue1, fgHue2, fgHue3];

  var getColor = function (i) {
    var customHues = [fgHue1, fgHue2, fgHue3];

    if (typeof colorLib[palette][i] == "undefined") {
      switch (palette) {
        case "Rainbow":
          colorLib[palette][i] = [Math.random() * 360, 100];
          if (rainBg < 360) {
            rainBg += speedRaw / 50;
          } else {
            rainBg = 0;
          }
          colorLib[palette]["bg"] = "hsla(" + rainBg + ",100%,40%,0.2)";
          break;
        case "Space":
          colorLib[palette][i] =
            spaceLib[Math.floor(Math.random() * spaceLib.length)];
          colorLib[palette]["bg"] = "hsla(" + spaceLibBg + ",100%,40%,0.2)";
          break;
        case "Custom":
          var h = customHues[Math.floor(Math.random() * customHues.length)];
          colorLib[palette][i] = [h, 100];
          colorLib[palette]["bg"] = "hsla(" + customHues[0] + ",100%,40%,0.2)";
          break;
        case "Random":
          colorLib[palette][i] = [
            Math.round(Math.random() * 360),
            Math.round(Math.random() * 100),
            (colorLib[palette]["bg"] = "hsla(" + randomBg + ",100%,40%,0.2)"),
          ];
          break;
        default:
          console.log("Unknown palette.");
          return [0, 0];
      }
    }

    return colorLib[palette][i];
  };

  for (let i = 0; i < 300; i++) {
    effects.push(new Particle(true));
  }

  function update() {
    customHues = [fgHue1, fgHue2, fgHue3];

    if (extremeMode) {

      ctx.scale(3.2,3.3);
      ctx.drawImage(bgImage, 0, 0);
      ctx.resetTransform();

      ctx.fillStyle = colorLib[palette]["bg"];
      ctx.fillRect(0, 0, width, height);

      if (effects.length < 500) {
        effects.push(new Particle(false));
      }

      for (i = 0; i < effects.length; i++) {
        effects[i].Draw();
      }

      for (j = 0; j < effects.length; j++) {
        if (effects[j].IsFinished()) {
          effects.splice(j, 1);
        }
      }

      ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.arc(160, 100, eventHoriz, 0, 2 * Math.PI);
      ctx.fill();
    } else {
      if (typeof colorLib[palette]["bg"] == "undefined") {
        var generateBg = getColor(0);
      }
      ctx.scale(3.2,3.3);
      ctx.drawImage(bgImage, 0, 0);
      ctx.resetTransform();
      if (palette == "Rainbow") {
        ctx.fillStyle = "hsl(" + rotate + ",100%,8%)";
      } else {
        ctx.fillStyle = colorLib[palette]["bg"];
      }
      ctx.fillRect(0, 0, width, height);

      ctx.translate(160, 100);
      ctx.rotate((rotate * Math.PI) / 180);
      ctx.translate(-160, -100);

      if (effects2.length < 500) {
        effects2.push(new Particle1());
        effects2.push(new Particle2());
        effects2.push(new Particle3());
        effects2.push(new Particle4());
      }

      for (i = 0; i < effects2.length; i++) {
        effects2[i].Draw();
      }

      for (j = 0; j < effects2.length; j++) {
        if (effects2[j].IsFinished()) {
          effects2.splice(j, 1);
        }
      }

      if (rotate < 360) {
        rotate += speedRaw / 50;
      } else {
        rotate = 0;
      }

      ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.arc(160, 100, eventHoriz, 0, 2 * Math.PI);
      ctx.fill();
    }

    window.requestAnimationFrame(update);
  }

  window.requestAnimationFrame(update);

  /**
   * Returns a random integer between min (inclusive) and max (inclusive).
   * The value is no lower than min (or the next integer greater than min
   * if min isn't an integer) and no greater than max (or the next integer
   * lower than max if max isn't an integer).
   * Using Math.round() will give you a non-uniform distribution!
   * @param   {number}  min     The minimum random value
   * @param   {number}  max     The maximum random value
   * @return  {number}          The random output number
   */
  function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function Particle(init) {
    this.id = Math.floor(1000 + Math.random() * 9000);

    if (!init) {
      this.r = Math.random() * 30 + 150;
    } else {
      this.r = Math.random() * 160;
    }
    this.theta = 0;
    this.degrees = Math.random() * 360;
    this.pos = [];
    this.posLength = Math.random() * 20 + 15;
    this.hueDev = getRandomInt(-20, 20);
    this.custHue = getRandomInt(0, 2);
    this.l = 10;

    this.Draw = function () {
      this.theta = this.degrees * (Math.PI / 180);
      let x = 160 + this.r * Math.cos(this.theta);
      let y = 100 + this.r * Math.sin(this.theta);
      this.pos.push([x, y]);
      if (this.pos.length > this.posLength) {
        this.pos.splice(0, 1);
      }

      let colorArr = getColor(this.id);
      this.l = ((160 - this.r) / 160) * 100;

      if (this.degrees < 360) {
        this.degrees += speedRaw / 50;
      } else {
        this.degrees = 0;
        this.r -= Math.random() * 20;
      }

      for (let j = 0; j < this.pos.length; j++) {
        const coords = this.pos[j];
        if (palette != "Rainbow" && palette != "Custom") {
          var opacity = j / this.pos.length;
          ctx.fillStyle =
            "hsla(" +
            colorArr[0] +
            "," +
            colorArr[1] +
            "%," +
            this.l +
            "%," +
            opacity +
            ")";
        } else if (palette == "Custom") {
          var opacity = j / this.pos.length;
          ctx.fillStyle =
            "hsla(" +
            customHues[this.custHue] +
            "," +
            100 +
            "%," +
            this.l +
            "%," +
            opacity +
            ")";
        } else {
          var rainbowHue = this.r * 5 + this.hueDev;
          ctx.fillStyle =
            "hsla(" +
            rainbowHue +
            "," +
            colorArr[1] +
            "%," +
            this.l +
            "%," +
            1 +
            ")";
        }
        ctx.fillRect(
          coords[0] - partSize / 2,
          coords[1] - partSize / 2,
          partSize,
          partSize
        );
      }
    };

    this.IsFinished = function () {
      if (this.r < 0) {
        return true;
      } else {
        return false;
      }
    };
  }

  function Particle1() {
    this.x = getRandomInt(-60, 150);
    this.y = getRandomInt(-100, -70);
    this.xSpeed = Math.random();
    this.ySpeed = Math.random();
    this.size = 10;
    this.spaceColors = [getRandomInt(240, 280), getRandomInt(50, 100)];
    this.customId = getRandomInt(0, 2);
    this.randomColor = getRandomInt(0, 360);

    this.Draw = function () {
      if (palette == "Space") {
        ctx.fillStyle =
          "hsl(" + this.spaceColors[0] + "," + this.spaceColors[1] + "%,50%)";
      } else if (palette == "Custom") {
        ctx.fillStyle = "hsl(" + customHues[this.customId] + ",100%,50%)";
      } else if (palette == "Random") {
        ctx.fillStyle = "hsl(" + this.randomColor + ",100%,50%)";
      } else {
        ctx.fillStyle =
          "hsl(" + getDistance(this.x, this.y, 160, 100) + ",100%,50%)";
      }
      ctx.fillRect(this.x, this.y, partSize, partSize);
      this.x += this.xSpeed * (speedRaw / 50);
      this.y += this.ySpeed * (speedRaw / 50);
    };

    this.IsFinished = function () {
      if (this.y > 100 || this.x > 160) {
        return true;
      } else {
        return false;
      }
    };
  }

  function Particle2() {
    this.x = getRandomInt(160, 330);
    this.y = getRandomInt(-100, -70);
    this.xSpeed = Math.random();
    this.ySpeed = Math.random();
    this.size = 10;
    this.spaceColors = [getRandomInt(240, 280), getRandomInt(50, 100)];
    this.customId = getRandomInt(0, 2);
    this.randomColor = getRandomInt(0, 360);

    this.Draw = function () {
      if (palette == "Space") {
        ctx.fillStyle =
          "hsl(" + this.spaceColors[0] + "," + this.spaceColors[1] + "%,50%)";
      } else if (palette == "Custom") {
        ctx.fillStyle = "hsl(" + customHues[this.customId] + ",100%,50%)";
      } else if (palette == "Random") {
        ctx.fillStyle = "hsl(" + this.randomColor + ",100%,50%)";
      } else {
        ctx.fillStyle =
          "hsl(" + getDistance(this.x, this.y, 160, 100) + ",100%,50%)";
      }
      ctx.fillRect(this.x, this.y, partSize, partSize);
      this.x -= this.xSpeed * (speedRaw / 50);
      this.y += this.ySpeed * (speedRaw / 50);
    };

    this.IsFinished = function () {
      if (this.y > 100 || this.x < 160) {
        return true;
      } else {
        return false;
      }
    };
  }

  function Particle3() {
    this.x = getRandomInt(-60, 150);
    this.y = getRandomInt(200, 280);
    this.xSpeed = Math.random();
    this.ySpeed = Math.random();
    this.size = 10;
    this.spaceColors = [getRandomInt(240, 280), getRandomInt(50, 100)];
    this.customId = getRandomInt(0, 2);
    this.randomColor = getRandomInt(0, 360);

    this.Draw = function () {
      if (palette == "Space") {
        ctx.fillStyle =
          "hsl(" + this.spaceColors[0] + "," + this.spaceColors[1] + "%,50%)";
      } else if (palette == "Custom") {
        ctx.fillStyle = "hsl(" + customHues[this.customId] + ",100%,50%)";
      } else if (palette == "Random") {
        ctx.fillStyle = "hsl(" + this.randomColor + ",100%,50%)";
      } else {
        ctx.fillStyle =
          "hsl(" + getDistance(this.x, this.y, 160, 100) + ",100%,50%)";
      }
      ctx.fillRect(this.x, this.y, partSize, partSize);
      this.x += this.xSpeed * (speedRaw / 50);
      this.y -= this.ySpeed * (speedRaw / 50);
    };

    this.IsFinished = function () {
      if (this.y < 100 || this.x > 160) {
        return true;
      } else {
        return false;
      }
    };
  }

  function Particle4() {
    this.x = getRandomInt(160, 330);
    this.y = getRandomInt(200, 280);
    this.xSpeed = Math.random();
    this.ySpeed = Math.random();
    this.size = 10;
    this.spaceColors = [getRandomInt(240, 280), getRandomInt(50, 100)];
    this.customId = getRandomInt(0, 2);
    this.randomColor = getRandomInt(0, 360);

    this.Draw = function () {
      if (palette == "Space") {
        ctx.fillStyle =
          "hsl(" + this.spaceColors[0] + "," + this.spaceColors[1] + "%,50%)";
      } else if (palette == "Custom") {
        ctx.fillStyle = "hsl(" + customHues[this.customId] + ",100%,50%)";
      } else if (palette == "Random") {
        ctx.fillStyle = "hsl(" + this.randomColor + ",100%,50%)";
      } else {
        ctx.fillStyle =
          "hsl(" + getDistance(this.x, this.y, 160, 100) + ",100%,50%)";
      }
      ctx.fillRect(this.x, this.y, partSize, partSize);
      this.x -= this.xSpeed * (speedRaw / 50);
      this.y -= this.ySpeed * (speedRaw / 50);
    };

    this.IsFinished = function () {
      if (this.y < 100 || this.x < 160) {
        return true;
      } else {
        return false;
      }
    };
  }

  function ExtremeParticle(init) {
    this.id = Math.floor(1000 + Math.random() * 9000);

    if (!init) {
      this.r = Math.random() * 30 + 150;
    } else {
      this.r = Math.random() * 160;
    }
    this.theta = 0;
    this.degrees = Math.random() * 360;
    this.pos = [];
    this.posLength = Math.random() * 20 + 15;
    this.hueDev = getRandomInt(-20, 20);
    this.custHue = getRandomInt(0, 2);
    this.l = 10;

    this.Draw = function () {
      this.theta = this.degrees * (Math.PI / 180);
      let x = 160 + this.r * Math.cos(this.theta);
      let y = 100 + this.r * Math.sin(this.theta);
      this.pos.push([x, y]);
      if (this.pos.length > this.posLength) {
        this.pos.splice(0, 1);
      }

      let colorArr = getColor(this.id);
      this.l = ((160 - this.r) / 160) * 100;

      if (this.degrees < 360) {
        this.degrees += speedRaw / 50;
      } else {
        this.degrees = 0;
        this.r -= Math.random() * 20;
      }

      for (let j = 0; j < this.pos.length; j++) {
        const coords = this.pos[j];
        if (palette != "Rainbow" && palette != "Custom") {
          var opacity = j / this.pos.length;
          ctx.fillStyle =
            "hsla(" +
            colorArr[0] +
            "," +
            colorArr[1] +
            "%," +
            this.l +
            "%," +
            opacity +
            ")";
        } else if (palette == "Custom") {
          var opacity = j / this.pos.length;
          ctx.fillStyle =
            "hsla(" +
            customHues[this.custHue] +
            "," +
            100 +
            "%," +
            this.l +
            "%," +
            opacity +
            ")";
        } else {
          var rainbowHue = this.r * 5 + this.hueDev;
          ctx.fillStyle =
            "hsla(" +
            rainbowHue +
            "," +
            colorArr[1] +
            "%," +
            this.l +
            "%," +
            1 +
            ")";
        }
        ctx.fillRect(
          coords[0] - partSize / 2,
          coords[1] - partSize / 2,
          partSize,
          partSize
        );
      }
    };

    this.IsFinished = function () {
      if (this.r < 0) {
        return true;
      } else {
        return false;
      }
    };
  }

  function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function getDistance(x1, y1, x2, y2) {
    let y = x2 - x1;
    let x = y2 - y1;
    return Math.sqrt(x * x + y * y);
  }

  //engine.zone
</script>
