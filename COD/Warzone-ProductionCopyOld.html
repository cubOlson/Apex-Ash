<head>
  <title>COD: Warzone Production</title>
  <meta description="Metering for COD Warzone."/>
  <meta publisher="WhirlwindFX" />

  <meta meter="health" tags="cod,warzone,modern warfare,call of duty" x=".0338" y=".9444" width=".10" h="0-360" s="0-25" l="40-100" type="linear" />
  <meta meter="healthR" tags="cod,warzone,modern warfare,call of duty" x=".0338" y=".9444" width=".10" h="0-10" s="50-100" l="40-75" type="linear" />
  <meta meter="healthG" tags="cod,warzone,modern warfare,call of duty" x=".0338" y=".9444" width=".10" h="110-130" s="40-100" l="50-75" type="linear" />
  <meta meter="plate1" tags="cod,warzone,modern warfare,call of duty" x=".0338" y=".9333" width=".0312" h="190-248" s="30-100" l="40-100" type="linear" />
  <meta meter="plate2" tags="cod,warzone,modern warfare,call of duty" x=".0693" y=".9333" width=".0312" h="190-248" s="30-100" l="40-100" type="linear" />
  <meta meter="plate3" tags="cod,warzone,modern warfare,call of duty" x=".1042" y=".9333" width=".0302" h="190-248" s="30-100" l="40-100" type="linear" />
  <meta meter="kill1" tags="cod,warzone,modern warfare,call of duty" x=".474" y=".8287" width=".05" h="5-25" s="50-100" l="50-75" type="linear" />
  <meta meter="kill2" tags="cod,warzone,modern warfare,call of duty" x=".474" y=".8676" width=".05" h="5-25" s="50-100" l="50-75" type="linear" />
  <meta meter="killBlack" tags="cod,warzone,modern warfare,call of duty" x=".476" y=".8315" width=".04" height=".01" h="0-360" s="0-75" l="0-40" type="area" />
  <meta meter="vPlusHorizontal" tags="cod,warzone,modern warfare,call of duty" x=".4536" y=".6861" width=".01" h="0-360" s="0-50" l="85-100" type="linear" />
  <meta meter="vPlusVertical" tags="cod,warzone,modern warfare,call of duty" x=".4586" y=".6787" width=".0008" height=".01" h="0-360" s="0-50" l="85-100" type="area" />
  <meta meter="vHealth" tags="cod,warzone,modern warfare,call of duty" x=".4672" y=".6852" width=".064" h="0-360" s="0-50" l="85-100" type="linear" />
  <meta meter="passengerExit" tags="cod,warzone,modern warfare,call of duty" x=".5985" y=".776" width=".011" h="0-360" s="0-50" l="85-100" type="linear" />
  <meta meter="driverHorn" tags="cod,warzone,modern warfare,call of duty" x=".3891" y=".776" width=".012" h="0-360" s="0-50" l="85-100" type="linear" />
  <meta meter="knockdownOrange" tags="cod,warzone,modern warfare,call of duty" x=".4958" y=".6574" width=".005" height=".005" h="20-40" s="40-100" l="60-100" type="area" />
  <meta meter="reviveGreen" tags="cod,warzone,modern warfare,call of duty" x=".4958" y=".6574" width=".005" height=".005" h="90-110" s="75-100" l="60-100" type="area" />
  <meta meter="gulagWhiteHP" tags="cod,warzone,modern warfare,call of duty" x=".4036" y=".0917" width=".07" h="0-360" s="0-50" l="70-100" type="linear" />
  <meta meter="gulagRedHP" tags="cod,warzone,modern warfare,call of duty" x=".5245" y=".0917" width=".07" h="0-360" s="0-25" l="40-100" type="linear" />
  <meta meter="circleClosingBlack" tags="cod,warzone,modern warfare,call of duty" x=".4943" y=".2019" width=".011" height=".011" h="0-360" s="0-25" l="0-25" type="area" />
  <meta meter="circleClosingRed" tags="cod,warzone,modern warfare,call of duty" x=".4974" y=".2741" width=".006" height=".003" h="0-20" s="50-75" l="25-50" type="area" />
</head>

<body style="margin: 0; padding: 0; background: #000;">
<canvas id="exCanvas" width="320" height="200"></canvas>  
</body>

<script>    
var canvas, ctx;
var stateMgr = new StateHandler();
stateMgr.Push(new IdleState());

var healthMeter = new Meter(5, healthEffects);
var healthRedMeter = new Meter(5, ()=>"");
var healthGreenMeter = new Meter(5, ()=>"");
var plate1Meter = new Meter(5, armorEffects);
var plate2Meter = new Meter(5, armorEffects);
var plate3Meter = new Meter(5, armorEffects);
var kill1Meter = new Meter(5, killEffect);
var kill2Meter = new Meter(5, killEffect);
var killBlackMeter = new Meter(5, killEffect);
var vPlusHorizMeter = new Meter(5, vehicleEffects);
var vPlusVertMeter = new Meter(5, vehicleEffects);
var vHealthMeter = new Meter(5, vehicleEffects);
var passengerExitMeter = new Meter(5, vehicleEffects);
var driverHornMeter = new Meter(5, vehicleEffects);
var downOrangeMeter = new Meter(5, knockdownEffect);
var reviveGreenMeter = new Meter(5, reviveEffect);
var gulagWhiteMeter = new Meter(5, gulagEffect);
var gulagRedMeter = new Meter(5, gulagEffect);
var circleBlackMeter = new Meter(5, circleEffects);
var circleRedMeter = new Meter(5, circleEffects);

function update(){ 
  stateMgr.Process();
  window.requestAnimationFrame(update);
}

function healthEffects(){
  console.log("In health effects");
}

function armorEffects(){
  console.log("In armor effects");
}

function killEffect(){
  console.log("In kill effect");
}

function vehicleEffects(){
  console.log("In vehicle effects");
}

function knockdownEffect(){
  console.log("In knockdown effect");
}

function reviveEffect(){
  console.log("In revive effect");
}

function gulagEffect(){
  console.log("In gulag effect");
}

function circleEffects(){
  console.log("In circle effects");
}


function IdleState(){
  this.Process = function() {
    let lightness = new Int8Array(engine.zone.lightness);
    let sat = new Int8Array(engine.zone.saturation);
    let hue = new Int16Array(engine.zone.hue);

    for(var iZone = 0; iZone < 560; iZone++)
    {        
      ctx.fillStyle = 'hsl('+hue[iZone]+','+sat[iZone]+'%,'+lightness[iZone]+'%)'
      
      var iRow = Math.floor(iZone / 28);
      var iCol = iZone % 28;
      var iWidth = 320 / 28;
      var iHeight = 200 / 20;
      var iZx = iCol * iWidth;
      var iZy = iRow * iHeight;
      
      ctx.fillRect(iZx, iZy, iWidth, iHeight);
    }
  }
}



function StateHandler(){
  var stack = [];
  var state = null;

  var updateState = function() {
    if (stack.length > 0){
      state = stack[stack.length - 1];
    } else {
      state = null;
    }
  }

  this.Push = function(newState)
  {
    stack.push(newState);
    updateState();    
  }

  this.Pop = function()
  {
    stack.pop();
    updateState();
  }

  this.Process = function()
  {    
    if (state != null){      
      state.Process();
    }
  }
}



function Meter(count, callback){
  this.size = count;
  this.value = 0;
  this.diff = 0;
  this.increased = false;
  this.decreased = false;
  var values = [];
  
  this.setValue = function(updatedValue) 
  {
    // Add and shift.  
    values.push(updatedValue);
    if (values.length > this.size) { values.shift(); }

    // Exit early if we've got a long-term match.
    for(var i=0; i < (values.length - 1); i++){
      if (values[i] !== values[i+1]) return;
    }

    // We got here, so we've got a matching value collection.
    if (this.value !== values[0]) {
      //var fromZero = this.value === 0;
      //var toZero = values[0] === 0;      
      this.diff = Math.abs(this.value - values[0]);
      this.increased = this.value < values[0];
      this.decreased = this.value > values[0];        
      this.value = values[0];
      callback();      
    }
  }
} 

function onEngineReady()
{      
  // Grab canvas and rendering context.
  canvas = document.getElementById( 'exCanvas' );
  ctx = canvas.getContext( '2d' );            

  stateMgr.Push(new IdleState());
  // Start updates *after* our engine is accessible and ready.
  window.requestAnimationFrame(update);      
}
onEngineReady()

</script>
