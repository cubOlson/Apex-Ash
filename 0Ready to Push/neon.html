<head>
  <title>Neon</title>
  <meta description="Neon glows pink from your devices." />
  <meta publisher="Jack Pendleton" />
  <meta
    property="bgColor"
    label="Background Color"
    type="color"
    min="0"
    max="360"
    default="#360b26"
  />
  <meta
    property="color1"
    label="Color 1"
    type="color"
    min="0"
    max="360"
    default="#ff008a"
  />
  <meta
    property="color2"
    label="Color 2"
    type="color"
    min="0"
    max="360"
    default="#ff66b2"
  />
  <meta
    property="color3"
    label="Color 3"
    type="color"
    min="0"
    max="360"
    default="#ffffff"
  />
  <meta
    property="speedRaw"
    label="Speed"
    type="number"
    min="1"
    max="10"
    default="1"
  />
  <meta
    property="tapEffect"
    label="Keypress effect"
    type="boolean"
    default="1"
  />
</head>

<body style="margin: 0; padding: 0">
  <canvas id="exCanvas" width="320" height="200"></canvas>
</body>

<script>
  var c = document.getElementById("exCanvas");
  var ctx = c.getContext("2d");
  var width = 320;
  var height = 200;
  var effects = [];
  var stars = [];
  var colors = [];
  var bgColor = "#360b26";
  var colors = ["#ff008a", "#ff66b2"];
  var color3 = "#ffffff";
  var speedRaw = 5;
  var tapEffect = true;

  for (let i = 0; i < 100; i++) {
    effects.push(new InitSquare());
  }

  function update() {
    colors = [color1, color2];
    ctx.fillStyle = bgColor + "22";
    ctx.fillRect(0, 0, width, height);

    if (effects.length < 200) {
      effects.push(new Square());
      effects.push(new UpSquare());
    }

    for (i = 0; i < effects.length; i++) {
      effects[i].Draw();
    }

    for (j = 0; j < effects.length; j++) {
      if (effects[j].IsFinished()) {
        effects.splice(j, 1);
      }
    }

    if (stars.length < 20) {
      stars.push(new Star());
    }

    for (i = 0; i < stars.length; i++) {
      stars[i].Draw();
    }

    for (j = 0; j < stars.length; j++) {
      if (stars[j].IsFinished()) {
        stars.splice(j, 1);
      }
    }

    console.log(effects.length);

    window.requestAnimationFrame(update);
  }

  window.requestAnimationFrame(update);

  function InitSquare() {
    this.x = Math.random() * 320;
    this.y = Math.random() * 200;
    this.speedX =
      Math.random() *
      (Math.ceil(Math.random() * 1) * (Math.round(Math.random()) ? 1 : -1));
    this.speedY =
      Math.random() *
      (Math.ceil(Math.random() * 1) * (Math.round(Math.random()) ? 1 : -1));
    this.size = Math.round(Math.random() * 10) + 1;
    this.radius = 1;
    this.ssi = Math.floor(Math.random() * colors.length);

    this.Draw = function () {
      ctx.fillStyle = colors[this.ssi] + "22";
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
      this.y += this.speedX * (speedRaw / 5);
      this.x -= this.speedY * (speedRaw / 5);
      if (this.radius < 20) {
        this.radius += Math.random() * 1.5;
      }
    };

    this.IsFinished = function () {
      if (this.x < -20 || this.x > 340 || this.y < -20 || this.y > 220) {
        return true;
      } else {
        return false;
      }
    };
  }

  function Square() {
    this.x = 320 + Math.random() * 100;
    this.y = Math.random() * 200;
    this.speedX =
      Math.random() *
      (Math.ceil(Math.random() * 1) * (Math.round(Math.random()) ? 1 : -1));
    this.speedY =
      Math.random() *
      (Math.ceil(Math.random() * 1) * (Math.round(Math.random()) ? 1 : -1));
    this.size = Math.round(Math.random() * 10) + 1;
    this.radius = 1;
    this.ssi = Math.floor(Math.random() * colors.length);

    this.Draw = function () {
      ctx.fillStyle = colors[this.ssi] + "22";
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
      this.y += this.speedX * (speedRaw / 5);
      this.x -= this.speedY * (speedRaw / 5);
      if (this.radius < 20) {
        this.radius += Math.random() * 1.5;
      }
    };

    this.IsFinished = function () {
      if (this.x < -50 || this.x > 400 || this.y < -50 || this.y > 300) {
        return true;
      } else {
        return false;
      }
    };
  }

  function UpSquare() {
    this.x = 0 - Math.random() * 100;
    this.y = Math.random() * 200;
    this.speedX =
      Math.random() *
      (Math.ceil(Math.random() * 1) * (Math.round(Math.random()) ? 1 : -1));
    this.speedY =
      Math.random() *
      (Math.ceil(Math.random() * 1) * (Math.round(Math.random()) ? 1 : -1));
    this.size = Math.round(Math.random() * 10) + 1;
    this.radius = 1;
    this.ssi = Math.floor(Math.random() * colors.length);

    this.Draw = function () {
      ctx.fillStyle = colors[this.ssi] + "22";
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
      this.y += this.speedX * (speedRaw / 5);
      this.x += this.speedY * (speedRaw / 5);
      if (this.radius < 20) {
        this.radius += Math.random() * 1.5;
      }
    };

    this.IsFinished = function () {
      if (this.x < -50 || this.x > 400 || this.y < -50 || this.y > 300) {
        return true;
      } else {
        return false;
      }
    };
  }

  function Star() {
    this.x = Math.random() * 320;
    this.y = Math.random() * 200;
    this.speedX =
      Math.random() *
      (Math.ceil(Math.random() * 1) * (Math.round(Math.random()) ? 1 : -1));
    this.speedY =
      Math.random() *
      (Math.ceil(Math.random() * 1) * (Math.round(Math.random()) ? 1 : -1));
    this.lifetime = 50;

    this.Draw = function () {
      ctx.fillStyle = "#ffffff66";
      ctx.fillRect(this.x, this.y, 7, 7);
      this.lifetime--;
      this.x += this.speedX;
      this.y += this.speedY;
    };

    this.IsFinished = function () {
      if (this.lifetime < 0) {
        return true;
      } else {
        return false;
      }
    };
  }

  function Tap(x, y) {
    this.x = x;
    this.y = y;
    this.lifetime = 50;

    this.Draw = function () {
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(this.x, this.y, 10, 10);
      this.lifetime--;
    };

    this.IsFinished = function () {
      if (this.lifetime < 0) {
        return true;
      } else {
        return false;
      }
    };
  }

  function onCanvasTapped(x, y) {
    if (tapEffect) {
      effects.push(new Tap(x, y));
    }
  }
</script>
