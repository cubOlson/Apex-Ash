<head>
  <title>Black HoleV2</title>
  <meta description="Effect description goes here." />
  <meta publisher="SignalRGB" />
  <meta property="palette" label="Color palette" type="combobox" values="Rainbow,Space,Custom,Random" default="Space" />
  <meta property="bgColor" label="Background Color" type="color" min="0" max="360" default="#170026" />
  <meta property="fgHue1" label="Hue 1" type="hue" min="0" max="360" default="0" />
  <meta property="fgHue2" label="Hue 2" type="hue" min="0" max="360" default="130" />
  <meta property="fgHue3" label="Hue 3" type="hue" min="0" max="360" default="240" />
  <meta property="speedRaw" label="Speed" type="number" min="0" max="100" default="50" />
  <meta property="eventHoriz" label="Event Horizon Size" type="number" min="1" max="100" default="46" />
</head>

<body style="margin: 0; padding: 0">
  <canvas id="exCanvas" width="320" height="200"></canvas>
</body>

<script>
  var c = document.getElementById("exCanvas");
  var ctx = c.getContext("2d");
  var width = 320;
  var height = 200;
  var rotate = 1;

  var effects = [];
  var customColors = ["0", "90", "180"];

  function update() {
    customColors = [fgHue1, fgHue2, fgHue3];
    ctx.fillStyle = bgColor;
    ctx.globalAlpha = .1;
    ctx.fillRect(0, 0, width, height);
    ctx.globalAlpha = 1;

    ctx.translate(160, 100);
    ctx.rotate(rotate * Math.PI / 180);
    ctx.translate(-160, -100);

    if (effects.length < 500) {
      effects.push(new Particle1());
      effects.push(new Particle2());
      effects.push(new Particle3());
      effects.push(new Particle4());
    }

    for (i = 0; i < effects.length; i++) {
      effects[i].Draw();
    }

    for (j = 0; j < effects.length; j++) {
      if (effects[j].IsFinished()) {
        effects.splice(j, 1);
      }
    }

    if (rotate < 360) {
      rotate += (speedRaw / 50);
    } else {
      rotate = 0;
    }

    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(160, 100, eventHoriz, 0, 2 * Math.PI);
    ctx.fill();

    window.requestAnimationFrame(update);
  }

  window.requestAnimationFrame(update);

  function Particle1() {
    this.x = getRandomInt(-60, 150)
    this.y = getRandomInt(-100, -70);
    this.xSpeed = Math.random();
    this.ySpeed = Math.random();
    this.size = 10;
    this.spaceColors = [getRandomInt(240, 280), getRandomInt(50, 100)];
    this.customId = getRandomInt(0, 2);
    this.randomColor = getRandomInt(0, 360);

    this.Draw = function () {
      if (palette == "Space") {
        ctx.fillStyle = "hsl(" + this.spaceColors[0] + "," + this.spaceColors[1] + "%,50%)";
      } else if (palette == "Custom") {
        ctx.fillStyle = "hsl(" + customColors[this.customId] + ",100%,50%)";
      } else if (palette == "Random") {
        ctx.fillStyle = "hsl(" + this.randomColor + ",100%,50%)";
      } else {
        ctx.fillStyle = "hsl(" + getDistance(this.x, this.y, 160, 100) + ",100%,50%)";
      }
      ctx.fillRect(this.x, this.y, 10, 10);
      this.x += this.xSpeed * (speedRaw / 50);
      this.y += this.ySpeed * (speedRaw / 50);
    };

    this.IsFinished = function () {
      if (this.y > 100 || this.x > 160) {
        return true;
      } else {
        return false;
      }
    };
  }

  function Particle2() {
    this.x = getRandomInt(160, 330)
    this.y = getRandomInt(-100, -70);
    this.xSpeed = Math.random();
    this.ySpeed = Math.random();
    this.size = 10;
    this.spaceColors = [getRandomInt(240, 280), getRandomInt(50, 100)];
    this.customId = getRandomInt(0, 2);
    this.randomColor = getRandomInt(0, 360);

    this.Draw = function () {
      if (palette == "Space") {
        ctx.fillStyle = "hsl(" + this.spaceColors[0] + "," + this.spaceColors[1] + "%,50%)";
      } else if (palette == "Custom") {
        ctx.fillStyle = "hsl(" + customColors[this.customId] + ",100%,50%)";
      } else if (palette == "Random") {
        ctx.fillStyle = "hsl(" + this.randomColor + ",100%,50%)";
      } else {
        ctx.fillStyle = "hsl(" + getDistance(this.x, this.y, 160, 100) + ",100%,50%)";
      }
      ctx.fillRect(this.x, this.y, 10, 10);
      this.x -= this.xSpeed * (speedRaw / 50);
      this.y += this.ySpeed * (speedRaw / 50);
    };

    this.IsFinished = function () {
      if (this.y > 100 || this.x < 160) {
        return true;
      } else {
        return false;
      }
    };
  }


  function Particle3() {
    this.x = getRandomInt(-60, 150)
    this.y = getRandomInt(200, 280);
    this.xSpeed = Math.random();
    this.ySpeed = Math.random();
    this.size = 10;
    this.spaceColors = [getRandomInt(240, 280), getRandomInt(50, 100)];
    this.customId = getRandomInt(0, 2);
    this.randomColor = getRandomInt(0, 360);

    this.Draw = function () {
      if (palette == "Space") {
        ctx.fillStyle = "hsl(" + this.spaceColors[0] + "," + this.spaceColors[1] + "%,50%)";
      } else if (palette == "Custom") {
        ctx.fillStyle = "hsl(" + customColors[this.customId] + ",100%,50%)";
      } else if (palette == "Random") {
        ctx.fillStyle = "hsl(" + this.randomColor + ",100%,50%)";
      } else {
        ctx.fillStyle = "hsl(" + getDistance(this.x, this.y, 160, 100) + ",100%,50%)";
      }
      ctx.fillRect(this.x, this.y, 10, 10);
      this.x += this.xSpeed * (speedRaw / 50);
      this.y -= this.ySpeed * (speedRaw / 50);
    };

    this.IsFinished = function () {
      if (this.y < 100 || this.x > 160) {
        return true;
      } else {
        return false;
      }
    };
  }

  function Particle4() {
    this.x = getRandomInt(160, 330)
    this.y = getRandomInt(200, 280);
    this.xSpeed = Math.random();
    this.ySpeed = Math.random();
    this.size = 10;
    this.spaceColors = [getRandomInt(240, 280), getRandomInt(50, 100)];
    this.customId = getRandomInt(0, 2);
    this.randomColor = getRandomInt(0, 360);

    this.Draw = function () {
      if (palette == "Space") {
        ctx.fillStyle = "hsl(" + this.spaceColors[0] + "," + this.spaceColors[1] + "%,50%)";
      } else if (palette == "Custom") {
        ctx.fillStyle = "hsl(" + customColors[this.customId] + ",100%,50%)";
      } else if (palette == "Random") {
        ctx.fillStyle = "hsl(" + this.randomColor + ",100%,50%)";
      } else {
        ctx.fillStyle = "hsl(" + getDistance(this.x, this.y, 160, 100) + ",100%,50%)";
      }
      ctx.fillRect(this.x, this.y, 10, 10);
      this.x -= this.xSpeed * (speedRaw / 50);
      this.y -= this.ySpeed * (speedRaw / 50);
    };

    this.IsFinished = function () {
      if (this.y < 100 || this.x < 160) {
        return true;
      } else {
        return false;
      }
    };
  }

  function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function getDistance(x1, y1, x2, y2) {
    let y = x2 - x1;
    let x = y2 - y1;
    return Math.sqrt(x * x + y * y);
  }
</script>