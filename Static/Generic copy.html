<head>
    <title>Basic Effects</title>
    <meta description="Basic Effects" />
    <meta publisher="SignalRgb" />
    <meta property="effectY" label="Y" type="number" min="0" max="200" default="100"/>
    <meta property="effectRadius" label="Radius" type="number" min="0" max="50" default="10"/>
    <meta property="effectNumber" label="Number" type="number" min="1" max="3" default="1"/>

</head>
<body style="margin: 0; padding: 0; background: #000;">
  <canvas id="exCanvas" width="320" height="200"></canvas>
</body>
<script>
  canvas = document.getElementById('exCanvas');
  ctx = canvas.getContext('2d');
  var effects = [];

  function update(){
    copyScreen(1)

    if(effects.length < 1){
      effects.push(new enemyKilledEffect());
    }

    effects.forEach((ele, i) => {
      ele.draw();
      if(ele.lifetime <= 0){
        effects.splice(i, 1);
      }
    });

    window.requestAnimationFrame(update);
  }

  function enemyKilledEffect(){
    this.lifetime = 10;
    this.start = Date.now();
    this.draw = function(){
      this.elapsed = Date.now() - this.start;
      if(this.elapsed < 500){
        ctx.beginPath();
        ctx.globalAlpha = 1 - (this.elapsed / 750);
        ctx.strokeStyle = "red";
        ctx.lineWidth = 20;
        ctx.moveTo(80, 0);
        ctx.lineTo(240, 200);
        ctx.stroke();
        ctx.globalAlpha = 1;
      }
      if(this.elapsed > 250 && this.elapsed < 1000){
        ctx.beginPath();
        ctx.globalAlpha = 1 - ((this.elapsed - 250) / 1000);
        ctx.strokeStyle = "red";
        ctx.lineWidth = 20;
        ctx.moveTo(240, 0);
        ctx.lineTo(80, 200);
        ctx.stroke();
        ctx.globalAlpha = 1;
      }
      if(this.elapsed > 500){
        for(let i = 0; i < 4; i++){
          effects.push(new movingParticle(320 * Math.random(), 200, "yellow"));
        }
      }
      if(this.elapsed > 750 && this.elapsed < 1500){
        ctx.beginPath();
        ctx.globalAlpha = 1 - ((this.elapsed - 750) / 1500);
        ctx.strokeStyle = "red";
        ctx.lineWidth = 20;
        ctx.moveTo(0, 100);
        ctx.lineTo(320, 100);
        ctx.stroke();
        ctx.globalAlpha = 1;
      }
      if(this.elapsed > 1500){
        this.lifetime = 0;
      }
    }
  }

  function movingParticle(x, y, color){
    this.x = x;
    this.y = y;
    this.color = color;
    this.radius = Math.random() * 30;
    this.vy = 8 * Math.random() + 1;
    this.vx = 3 * Math.random() + 1;
    this.lifetime = 10;

    this.draw = function(){
      DrawCircle(this.x, this.y, this.radius, this.color);
      this.x += this.vx;
      this.y -= this.vy;
      if(this.y < 0){
        this.lifetime = 0;
      }
    }
  };

  function copyScreen(alpha) {
    let lightness = new Int8Array(engine.zone.lightness);
    let sat = new Int8Array(engine.zone.saturation);
    let hue = new Int16Array(engine.zone.hue);

    for (var iZone = 0; iZone < 560; iZone++) {
        ctx.fillStyle =
          "hsla(" +
          hue[iZone] +
          "," +
          sat[iZone] +
          "%," +
          lightness[iZone] +
          "%, " +
          alpha
          +
          ")";
      
      var iRow = Math.floor(iZone / 28);
      var iCol = iZone % 28;
      var iWidth = 320 / 28;
      var iHeight = 200 / 20;
      var iZx = iCol * iWidth;
      var iZy = iRow * iHeight;

      ctx.fillRect(iZx, iZy, iWidth, iHeight);
    }
  }

    function DrawCircle(x,y,radius,color){
        ctx.beginPath();
        ctx.fillStyle = color;
        ctx.arc(x,y,radius, 0, 2* Math.PI)
        ctx.fill();
    };

  window.requestAnimationFrame(update);
</script>
  