<head>
    <title>Testing File</title>
    <meta description="Basic Effects" />
    <meta publisher="SignalRgb" />

    <meta property="Speed" label="speed" type="number" min="0" max="100" default="50"/>
    <meta property="Size" label="size" type="number" min="0" max="100" default="50"/>
    <meta property="ParticleCount" label="particle count" type="number" min="0" max="200" default="20"/>
    <meta
    property="saber1"
    label="Lightsaber 1 Color"
    type="color"
    min="0"
    max="360"
    default="#FF0000"
    />
    <meta
    property="saber2"
    label="Lightsaber 2 Color"
    type="color"
    min="0"
    max="360"
    default="#0000FF"
    />

</head>
<body style="margin: 0; padding: 0; background: #000;">
  <canvas id="exCanvas" width="320" height="200"></canvas>
</body>
<script>
  canvas = document.getElementById('exCanvas');
  ctx = canvas.getContext('2d');
  var effects = [];

  function update(){
    ctx.globalAlpha = .15;
    DrawRect(0, 0, 320, 200, "black");
    ctx.globalAlpha = 1;

    if(effects.length < 1){
      effects.push(new slash1(saber1, saber2))
    }

    effects.forEach((ele, i) => {
      ele.draw();
      if(ele.lifetime <= 0){
        effects.splice(i, 1);
      }
    });

    window.requestAnimationFrame(update);
  }

  function slash1(color1, color2){
    this.start = Date.now();
    this.color1 = color1;
    this.color2 = color2;
    this.light1 = new lightsaber(80, 150, this.color1, 0);
    this.light2 = new lightsaber(200, 150, this.color2, 0);
    this.lifetime = 10;
    this.count = 0;
    this.draw = function(){
      var elapsed = Date.now() - this.start;

      if(elapsed < 200){
        this.light1.x -= 1;
        this.light1.rotation = .1;
        this.light2.x += 1;
        this.light2.rotation = -.1;
      } else if (elapsed < 800){
        if(this.count == 0){
          effects.push(new contact(this.x, this.y))
          this.count++
        }
        this.light1.y += Math.sin(Date.now() / 100);
        this.light1.rotation = 0;
        this.light2.y += Math.sin(Date.now() / 100);
        this.light2.rotation = 0;
      } else if (elapsed < 1000){
        this.light1.x -= 7;
        this.light1.y -= 3;
        this.light1.rotation = .1;
        this.light2.x += 1;
        this.light2.y -= 8;
        this.light2.rotation = .3;
      } else if (elapsed < 1200){
        if(this.count == 1){
          setTimeout(()=>{effects.push(new contact(this.x, this.y))}, 100)
          this.count++
        }
        this.light1.x += 5;
        this.light1.y -= 7;
        this.light1.rotation = .05;
        this.light2.x -= 1;
        this.light2.y += 6;
        this.light2.rotation = -.5;
      } else if (elapsed < 1400){
        this.light1.x += 0;
        this.light1.y += 9.5;
        this.light1.rotation = -.25;
        this.light2.x -= 1;
        this.light2.y += 1.5;
        this.light2.rotation = .3;
      } else {
        this.light1.rotation = 0;
        this.light2.rotation = 0;
        new lightsaber(80, 150, this.color1, 0).draw()
        new lightsaber(200, 150, this.color2, 0).draw()
        this.lifetime = 0;
        return
      }

      this.light1.draw();
      this.light2.draw();
    }
  };

  function lightsaber(x, y, color, rotation){
    this.x = x;
    this.y = y;
    this.color = color;
    this.rotation = rotation;
    this.rotate = 0;
    this.draw = function(){
      ctx.save();
      ctx.translate(this.x + 20, this.y);
      ctx.rotate(this.rotate);
      ctx.translate(-this.x - 20, -this.y);
      ctx.globalAlpha = Math.abs(Math.sin(Date.now() / 10))
      DrawRect(this.x, this.y, 40, -110, this.color);
      DrawCircle(this.x + 20, this.y - 110, 20, this.color)
      ctx.globalAlpha = 1;
      DrawRect(this.x + 12.5, this.y, 15, -100, "white");
      DrawCircle(this.x + 20.5, this.y - 100, 7.5, "white")
      ctx.restore();
      this.rotate += this.rotation;
    }
  };

  function contact(){
    this.lifetime = 10;
    this.alpha = .8;
    this.color1 = hexToRgb(saber1)
    this.color2 = hexToRgb(saber2)
    this.r = (this.color1.r + this.color2.r) / 2;
    this.g = (this.color1.g + this.color2.g) / 2;
    this.b = (this.color1.b + this.color2.b) / 2;
    this.draw = function(){
      ctx.globalAlpha = this.alpha;
      DrawRect(0, 0, 320, 200, `white`)
      DrawRect(0, 0, 320, 200, `rgb(${this.r}, ${this.g}, ${this.b})`)
      ctx.globalAlpha = 1;
      this.alpha > 0 ? this.alpha -= .2 : this.lifetime = 0;
    }
  }

  function DrawPath(x, y, path, color){
    ctx.fillStyle = color;
    ctx.save();
    ctx.translate(x, y);
    let ex = new Path2D(path);
    ctx.fill(ex);
    ctx.restore();
  };

    function DrawCircle(x, y, radius, color){
        ctx.beginPath();
        ctx.fillStyle = color;
        ctx.arc(x,y,radius, 0, 2* Math.PI)
        ctx.fill();
    };

    function DrawStroke(x, y, radius, color, stroke){
        ctx.beginPath();
        ctx.strokeStyle = color;
        ctx.lineWidth = stroke;
        ctx.arc(x,y,radius, 0, 2* Math.PI)
        ctx.stroke();
    };

    function DrawRect(x, y, width, height, color){
      ctx.beginPath();
      ctx.fillStyle = color;
      ctx.fillRect(x, y, width, height);
    };

    function DrawHex(x, y, color, size) {
      ctx.beginPath();
      for (var i = 0; i < 7; i++) {
        ctx.lineTo(x + size * Math.cos(2 * Math.PI / 6 * i), y + size * 0.9 * Math.sin(2 * Math.PI / 6 * i));
      }
      ctx.fillStyle = color;
      ctx.fill();
      ctx.strokeStyle = "black"
      ctx.stroke()
    };

    function hexToRgb(hex) {
      var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    }

  window.requestAnimationFrame(update);
</script>
  