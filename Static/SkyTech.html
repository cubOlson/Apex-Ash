<head>
    <title>SkyTech effect</title>
    <meta description="Basic Effects" />
    <meta publisher="SignalRgb" />

  <meta property="myHuePicker1" label="Hue Picker Control" type="hue" default="0" min="0" max="360">
  <meta property="myHuePicker2" label="Hue Picker Control" type="hue" default="65" min="0" max="360">
  <meta property="myHuePicker3" label="Hue Picker Control" type="hue" default="125" min="0" max="360">
  <meta property="myHuePicker4" label="Hue Picker Control" type="hue" default="205" min="0" max="360">

</head>
<body style="margin: 0; padding: 0; background: #000;">
  <canvas id="exCanvas" width="320" height="200"></canvas>
</body>
<script>
  canvas = document.getElementById('exCanvas');
  ctx = canvas.getContext('2d');
  var effects = [];
  var speeds = [];
  var hues = [];
  var separation = [];

  function update(){
    ctx.fillStyle = "rgb(10, 10, 10)";
    ctx.fillRect(0, 0, 320, 200);

    let frequency = new Int8Array(engine.audio.freq);

    console.log(frequency.reduce((a, b) => a + b, 0));

    hues = [myHuePicker1, myHuePicker2, myHuePicker3, myHuePicker4];
    separation = [22, 7, -7, -22];

    if (speeds.length < 10){
        speeds.push(new speedCircle());
    }
    speeds.forEach((ele, i) => {
      ele.draw();
      if (ele.lifetime <= 0){
        speeds.splice(i, 1);
      }
    });

    if (effects.length < 1){
      effects.push(new skyTechMain());
    }
    effects.forEach((ele, i) => {
      ele.draw();
      if (ele.lifetime <= 0){
        effects.splice(i, 1);
      }
    });

    window.requestAnimationFrame(update);
  }

  function skyTechMain(){
        this.lifetime = 20;
        this.x = 200;
        this.y = 100;
        this.now = Date.now();
        this.logo = new skyTechLogo();

        this.draw = function(){
          this.now = Date.now();
          var headY = Math.sin(this.now / 100) * 20 + this.y;

          for (let index = 0; index < 4; index ++){
            for (let i = 1; i <= 10; i++){
              var indexY = Math.sin((this.now - (i * 100)) / 100) * 20 + this.y;
              DrawCircle(this.x - (i * 20), indexY + separation[index], 10, `hsl(${hues[index]}, 100%, ${90 - 5 * i}%)`);
            }
          }
          this.logo.draw();
        }
      };

      function skyTechLogo(){
        this.x = 200;
        this.y = 100;
        this.now = 0;
        this.rotate = 1;
        this.draw = function(){
          this.now = Date.now();
          this.y = Math.sin(this.now / 100) * 10 + 100;
          ctx.save();
          ctx.translate(this.x, this.y);
          ctx.rotate(this.rotate);
          DrawCircle(0, 0, 50, "white");
          ctx.fillStyle = "red"
          ctx.fillRect(-15, 0, 90, 20);
          ctx.rotate(Math.PI * 2/3);
          ctx.fillRect(-15, 0, 90, 20);
          ctx.rotate(Math.PI * 2/3);
          ctx.fillRect(-15, 0, 90, 20);
          ctx.restore();
          this.rotate+=.1;
          if(this.rotate >= Math.PI * 2){
            this.rotate = 0;
          }
        }
      }

      function speedCircle(){
          this.x = 320;
          this.y = Math.random() * 200;
          this.lifetime = 10;

          this.draw = function(){
              DrawCircle(this.x, this.y, 10, `hsl(${hues[Math.floor(Math.random() * 4)]}, 100%, 50%)`);
              this.x-=20;
              if (this.x < 0){
                  this.lifetime = 0;
              }
          }
      }

      function DrawCircle(x,y,radius,color){
        ctx.beginPath();
        ctx.fillStyle = color;
        ctx.arc(x,y,radius, 0, 2* Math.PI)
        ctx.fill();
    };

  window.requestAnimationFrame(update);
</script>
  